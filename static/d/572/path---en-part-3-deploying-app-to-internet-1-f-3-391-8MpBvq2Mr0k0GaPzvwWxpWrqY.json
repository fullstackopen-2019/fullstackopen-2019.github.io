{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<p>Let's continue with our efforts to use the new backend with the React-frontend from <a href=\"/en/part2\">part 2</a>.\nOur last attempt failed with the following error message:</p>\n<picture><img src=\"/static/35a4438293bb22dd200358359d58157a/14be6/3.png\" srcset=\"/static/35a4438293bb22dd200358359d58157a/4cce7/3.png 200w,\n/static/35a4438293bb22dd200358359d58157a/bae5f/3.png 400w,\n/static/35a4438293bb22dd200358359d58157a/14be6/3.png 800w,\n/static/35a4438293bb22dd200358359d58157a/1b35a/3.png 1200w,\n/static/35a4438293bb22dd200358359d58157a/9ee03/3.png 1600w,\n/static/35a4438293bb22dd200358359d58157a/be508/3.png 1918w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>For some reason, the GET-request sent by the frontend to the address <a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a> is not working. Why is that? The backend works just fine in the browser and with Postman. </p>\n<h3>Same origin policy and CORS</h3>\n<p>The issue lies with a thing called CORS, or Cross-Origin Resource Sharing. </p>\n<p>According to <a href=\"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing\">Wikipedia</a>:</p>\n<blockquote>\n<p><i>Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the first resource was served. A web page may freely embed cross-origin images, stylesheets, scripts, iframes, and videos. Certain \"cross-domain\" requests, notably Ajax requests, are forbidden by default by the same-origin security policy.</i></p>\n</blockquote>\n<p>In our context the problem is that, by default, the JavaScript code of an application that runs in a browser can only communicate with a server in the same <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">origin</a>.\nBecause our server is in localhost port 3001, and our frontend in localhost port 3000, they do not have the same origin.</p>\n<p>Keep in mind, that <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">same origin policy</a> and CORS are not specific to React or Node. They are in fact universal principles of the operation of web applications. </p>\n<p>We can allow requests from other <i>origins</i> by using Node's <a href=\"https://github.com/expressjs/cors\">cors</a> middleware.</p>\n<p>Install <i>cors</i> with the command</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> cors --save</code></pre></div>\n<p>take the middleware to use and allow for requests from all origins: </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> cors <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cors'</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And the frontend works! However, the functionality for changing the importance of notes has not yet been implemented to the backend. </p>\n<p>You can read more about CORS from <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">Mozillas page</a>.</p>\n<h3>Application to the Internet</h3>\n<p>Now that the whole stack is ready, let's move our application to the internet. We'll use good old <a href=\"https://www.heroku.com\">Heroku</a> for this.</p>\n<blockquote>\n<p>If you have never used Heroku before, you can find instructions from <a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs\">Heroku documentation</a> or by Googling.</p>\n</blockquote>\n<p>Add a file called  <i>Procfile</i> to the project's root to tell Heroku how to start the application. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">web: node index.js</code></pre></div>\n<p>Change the definition of the port our application uses at the bottom of the <i>index.js</i> file like so: </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3001</span></span>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`Server running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now we are using the port defined in <a href=\"https://en.wikipedia.org/wiki/Environment_variable\">environment variable</a> <em>PORT</em> or port 3001 if the environment variable <em>PORT</em> is undefined.\nHeroku configures application port based on the environment variable. </p>\n<p>Create a Git repository in the project directory, and add <i>.gitignore</i> with the following contents</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">node_modules</code></pre></div>\n<p>Create a Heroku application with the command <i>heroku create</i>, create a Git repository in the application directory, commit the code and move it to Heroku with command <i>git push heroku master</i>.</p>\n<p>If everything went well, the application works:</p>\n<picture><img src=\"/static/d3234f60043338715ef3c0abc6ee701b/14be6/25e.png\" srcset=\"/static/d3234f60043338715ef3c0abc6ee701b/4cce7/25e.png 200w,\n/static/d3234f60043338715ef3c0abc6ee701b/bae5f/25e.png 400w,\n/static/d3234f60043338715ef3c0abc6ee701b/14be6/25e.png 800w,\n/static/d3234f60043338715ef3c0abc6ee701b/1b35a/25e.png 1200w,\n/static/d3234f60043338715ef3c0abc6ee701b/9ee03/25e.png 1600w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>If not, the issue can be found by reading heroku logs with command <i>heroku logs</i>.</p>\n<blockquote>\n<p><strong>NB</strong> At least in the beginning it's good to keep an eye on the heroku logs at all times. The best way to do this is with command <i>heroku logs -t</i> which prints the logs to console whenever something happens on the server. </p>\n</blockquote>\n<p>The frontend also works with the backend on Heroku. You can check this by changing the backend's address on the frontend to be the backend's address in Heroku instead of <i><a href=\"http://localhost:3001\">http://localhost:3001</a></i>.</p>\n<p>The next question is, how do we deploy the frontend to the Internet? We have multiple options. Let's go through one of them next. </p>\n<h3>Frontend production build</h3>\n<p>So far we have been running React code in <i>development mode</i>. In development mode the application is configured to give clear error messages, immediately render code changes to the browser, and so on. </p>\n<p>When the application is deployed, we must create a <a href=\"https://reactjs.org/docs/optimizing-performance.html#use-the-production-build\">production build</a> or a version of the application which is optimized for production. </p>\n<p>A production build of applications created with <i>create-react-app</i> can be created with command <a href=\"https://github.com/facebookincubator/create-react-app#npm-run-build-or-yarn-build\">npm run build</a>.</p>\n<p>Let's run this command from the <i>root of the frontend project</i>.</p>\n<p>This creates a directory called <i>build</i> (which contains the only HTML file of our application, <i>index.html</i> ) which contains the directory <i>static</i>. <a href=\"https://en.wikipedia.org/wiki/Minification_(programming)\">Minified</a> version of our application's JavaScript code will be generated to the <i>static</i>  directory. Even though the application code is in multiple files, all of the JavaScript will be minified into one file. Actually all of the code from all of the application's dependencies will also be minified into this single file. </p>\n<p>The minified code is not very readable. The beginning of the code looks like this: </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">!</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">function</span> <span class=\"token function\">r</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> n<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">,</span>i<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>l<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>a<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>c<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>s<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>c<span class=\"token operator\">&lt;</span>i<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>c<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>f<span class=\"token operator\">=</span>i<span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>n <span class=\"token keyword\">in</span> l<span class=\"token punctuation\">)</span>Object<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>hasOwnProperty<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>l<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">p</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> u<span class=\"token punctuation\">.</span>push<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">,</span>a<span class=\"token operator\">||</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">function</span> <span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> e<span class=\"token punctuation\">,</span>r<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>r<span class=\"token operator\">&lt;</span>u<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>r<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>u<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>n<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>t<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> l<span class=\"token operator\">=</span>t<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token number\">0</span><span class=\"token operator\">!==</span>o<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>n<span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">--</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>e<span class=\"token operator\">=</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>s<span class=\"token operator\">=</span>t<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">return</span> e<span class=\"token punctuation\">}</span><span class=\"token keyword\">var</span> n<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>o<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>u<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">return</span> n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">;</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">:</span>r<span class=\"token punctuation\">,</span>l<span class=\"token punctuation\">:</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>exports<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> e<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>l<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">}</span>f<span class=\"token punctuation\">.</span>m<span class=\"token operator\">=</span>e<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span>c<span class=\"token operator\">=</span>n<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">d</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>f<span class=\"token punctuation\">.</span><span class=\"token function\">o</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">)</span><span class=\"token operator\">||</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>enumerable<span class=\"token punctuation\">:</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">:</span>t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">r</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"undefined\"</span><span class=\"token operator\">!==</span><span class=\"token keyword\">typeof</span> Symbol<span class=\"token operator\">&amp;&amp;</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token operator\">&amp;&amp;</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span><span class=\"token string\">\"Module\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Serving static files from the backend</h3>\n<p>One option for deploying the frontend is to copy the production build (the <i>build</i> directory) to the root of the backend repository and configure the backend to show the frontend's <i>main page</i> (the file <i>build/index.html</i>) as its main page. </p>\n<p>We begin by copying the production build of the frontend to the root of the backend. With my computer the copying can be done from the frontend directory with the command</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> -r build <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/osa3/notes-backend</code></pre></div>\n<p>The backend directory should now look as follows:</p>\n<picture><img src=\"/static/a7724db60dee0c2ef626ba27021be323/14be6/27.png\" srcset=\"/static/a7724db60dee0c2ef626ba27021be323/4cce7/27.png 200w,\n/static/a7724db60dee0c2ef626ba27021be323/bae5f/27.png 400w,\n/static/a7724db60dee0c2ef626ba27021be323/14be6/27.png 800w,\n/static/a7724db60dee0c2ef626ba27021be323/1b35a/27.png 1200w,\n/static/a7724db60dee0c2ef626ba27021be323/cbaf6/27.png 1404w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>To make express show <i>static content</i>, the page <i>index.html</i> and the JavaScript etc. it fetches, we need a built-in middleware from express called <a href=\"http://expressjs.com/en/starter/static-files.html\">static</a>.</p>\n<p>When we add the following amidst the declarations of middlewares</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token keyword\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>whenever express gets an HTTP GET request it will first check if the <i>build</i> directory contains a file corresponding to the request's address. If a correct file is found, express will return it. </p>\n<p>Now HTTP GET requests to the address <i>www.serversaddress.com/index.html</i> or <i>www.serversaddress.com</i> will show the React frontend. GET requests to the address <i>www.serversaddress.com/notes</i> will be handled by the backend's code.</p>\n<p>Because on our situation, both the frontend and the backend are at the same address, we can declare <em>baseUrl</em> as a <a href=\"https://www.w3.org/TR/WD-html40-970917/htmlweb.html#h-5.1.2\">relative</a> URL. This means we can leave out the part declaring the server. </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/notes'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>baseUrl<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>After the change, we have to create a new production build and copy it to the root of the backend repository. </p>\n<p>The application can now be used from the <i>backend</i> address <a href=\"http://localhost:3001\">http://localhost:3001</a>:</p>\n<picture><img src=\"/static/f5d8aad803a0a13ea9b29fd705774ec8/14be6/28e.png\" srcset=\"/static/f5d8aad803a0a13ea9b29fd705774ec8/4cce7/28e.png 200w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/bae5f/28e.png 400w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/14be6/28e.png 800w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/1b35a/28e.png 1200w,\n/static/f5d8aad803a0a13ea9b29fd705774ec8/07092/28e.png 1336w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Our application now works exactly like the <a href=\"/en/part0/fundamentals_of_web_apps#single-page-app\">single-page app</a> example application we studied in part 0. </p>\n<p>When we use a browser to go to the address <a href=\"http://localhost:3001\">http://localhost:3001</a>, the server returns the <i>index.html</i> file from the <i>build</i> repository. Summarized contents of the file are as follows: </p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/css/main.f9a47af2.chunk.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/1.578f4ea1.chunk.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/main.104ca08d.chunk.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>The file contains instructions to fetch a CSS stylesheet defining the styles of the application, and two <i>script</i> tags which instruct the browser to fetch the JavaScript code of the application - the actual React application. </p>\n<p>The React code fetches notes from the server address <a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a> and renders them to the screen. The communications between the server and the browser can be seen in the <i>Network</i> tab of the developer console:</p>\n<picture><img src=\"/static/21cd1fa49d6943e82cc9bdfb4254a15d/14be6/29e.png\" srcset=\"/static/21cd1fa49d6943e82cc9bdfb4254a15d/4cce7/29e.png 200w,\n/static/21cd1fa49d6943e82cc9bdfb4254a15d/bae5f/29e.png 400w,\n/static/21cd1fa49d6943e82cc9bdfb4254a15d/14be6/29e.png 800w,\n/static/21cd1fa49d6943e82cc9bdfb4254a15d/1b35a/29e.png 1200w,\n/static/21cd1fa49d6943e82cc9bdfb4254a15d/9ee03/29e.png 1600w,\n/static/21cd1fa49d6943e82cc9bdfb4254a15d/fa119/29e.png 1750w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>After ensuring that the production version of the application works locally, commit the production build of the frontend to the backend repository, and push the code to Heroku again. </p>\n<p><a href=\"https://vast-oasis-81447.herokuapp.com/\">The application</a> works perfectly, except we haven't added the functionality for changing the importance of a note to the backend yet. </p>\n<picture><img src=\"/static/64ccdd6f24ef7a1e11e25174f1780983/14be6/30e.png\" srcset=\"/static/64ccdd6f24ef7a1e11e25174f1780983/4cce7/30e.png 200w,\n/static/64ccdd6f24ef7a1e11e25174f1780983/bae5f/30e.png 400w,\n/static/64ccdd6f24ef7a1e11e25174f1780983/14be6/30e.png 800w,\n/static/64ccdd6f24ef7a1e11e25174f1780983/1b35a/30e.png 1200w,\n/static/64ccdd6f24ef7a1e11e25174f1780983/89b0a/30e.png 1490w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Our application saves the notes to a variable. If the application crashes or is restarted, all of the data will disappear. </p>\n<p>The application needs a database. Before we introduce one, let's go through a few things. </p>\n<h3>Streamlining deploying of the frontend</h3>\n<p>To create a new production build of the frontend without extra manual work, let's add some npm-scripts to the <i>package.json</i> of the backend repository: </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"build:ui\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rm -rf build &amp;&amp; cd ../../osa2/materiaali/notes-new &amp;&amp; npm run build --prod &amp;&amp; cp -r build ../../../osa3/notes-backend/\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git push heroku master\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"deploy:full\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build:ui &amp;&amp; git add . &amp;&amp; git commit -m uibuild &amp;&amp; npm run deploy\"</span><span class=\"token punctuation\">,</span>    \n    <span class=\"token property\">\"logs:prod\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"heroku logs --tail\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The script <em>npm run build:ui</em> builds the frontend and copies the production version under the backend repository.  <em>npm run deploy</em> releases the current backend to heroku. </p>\n<p><em>npm run deploy:full</em> combines these two and contains the necessary <i>git</i> commands to update the backend repository. </p>\n<p>There is also a script <em>npm run logs:prod</em> to show the heroku logs.</p>\n<p>Note that the directory paths in the script <i>build:ui</i> depend on the location of repositories in the file system.</p>\n<h3>Backend URLs</h3>\n<p>Our backend's API for handling the notes is currently at the application's root URL <a href=\"https://vast-oasis-81447.herokuapp.com/\">https://vast-oasis-81447.herokuapp.com/</a>. This means that <a href=\"https://vast-oasis-81447.herokuapp.com/notes\">https://vast-oasis-81447.herokuapp.com/notes</a> is the list of all notes and so on. The role of the backend is to offer a machine readable interface or an API to the frontend. It might be better to name the API addresses more clearly, for example by starting all of them with the word <em>api</em>.</p>\n<p>Let's change <strong>all backend routes</strong> by hand: </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//...</span>\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//...</span></code></pre></div>\n<p>Frontend code only requires the following change: </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/notes'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>baseUrl<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>After these changes, the API endpoint for all notes is <a href=\"https://vast-oasis-81447.herokuapp.com/api/notes\">https://vast-oasis-81447.herokuapp.com/api/notes</a>.</p>\n<picture><img src=\"/static/47a5834818d17dd4ee20755cfa093c06/14be6/31e.png\" srcset=\"/static/47a5834818d17dd4ee20755cfa093c06/4cce7/31e.png 200w,\n/static/47a5834818d17dd4ee20755cfa093c06/bae5f/31e.png 400w,\n/static/47a5834818d17dd4ee20755cfa093c06/14be6/31e.png 800w,\n/static/47a5834818d17dd4ee20755cfa093c06/1b35a/31e.png 1200w,\n/static/47a5834818d17dd4ee20755cfa093c06/136ae/31e.png 1598w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Frontend is still at the root of the application at <a href=\"https://vast-oasis-81447.herokuapp.com/\">https://vast-oasis-81447.herokuapp.com/</a>. </p>\n<blockquote>\n<p>Sidenote: <strong>API versions</strong></p>\n<p>Sometimes API URLs also show the version of the API. Different versions might be needed if the API is extended over time and the changes could break existing parts of the programs. With versioning, new slightly different versions of the API can be used alongside older versions. </p>\n<p>Not everyone thinks expressing the API version on the URL is a good idea, even though it is done quite often. The right way of versioning APIs is debated <a href=\"https://stackoverflow.com/questions/389169/best-practices-for-api-versioning\">all over the internet</a>.</p>\n</blockquote>\n<h3>Proxy</h3>\n<p>Changes on the frontend have caused it to no longer work in development mode (when started with command <em>npm start</em>), as the connection to the backend does not work. </p>\n<picture><img src=\"/static/00f39fdcef07b47e547cb168ec52a868/14be6/32e.png\" srcset=\"/static/00f39fdcef07b47e547cb168ec52a868/4cce7/32e.png 200w,\n/static/00f39fdcef07b47e547cb168ec52a868/bae5f/32e.png 400w,\n/static/00f39fdcef07b47e547cb168ec52a868/14be6/32e.png 800w,\n/static/00f39fdcef07b47e547cb168ec52a868/1b35a/32e.png 1200w,\n/static/00f39fdcef07b47e547cb168ec52a868/dbfe6/32e.png 1440w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>This is due to changing the backend address to a relative URL: </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/notes'</span></code></pre></div>\n<p>Because in development mode the frontend is at the address <i>localhost:3000</i>, the requests to the backend go to the wrong address <i>localhost:3000/api/notes</i>. The backend is at <i>localhost:3001</i>. </p>\n<p>If the project was created with create-react-app, this problem is easy to solve. It is enough to add the following declaration to the <i>package.json</i> file of the frontend repository. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"dependencies\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n    // <span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"scripts\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n    // <span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">}</span>,\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"proxy\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"http://localhost:3001\"</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>After a restart, the React development environment will work as a <a href=\"https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#proxying-api-requests-in-development\">proxy</a>. If the React code does an HTTP request to a server address at <i><a href=\"http://localhost:3000\">http://localhost:3000</a></i> not managed by the React application itself (i.e when requests are not about fetching the CSS or JavaScript of the application), the request will be redirected to the server at <i><a href=\"http://localhost:3001\">http://localhost:3001</a></i>. </p>\n<p>Now the frontend is also fine, working with the server both in development- and production mode. </p>\n<p>A negative aspect of our approach is how complicated it is to deploy the frontend. Deploying a new version requires generating new production build of the frontend and copying it to the backend repository. This makes creating an automated <a href=\"https://martinfowler.com/bliki/DeploymentPipeline.html\">deployment pipeline</a> more difficult. Deployment pipeline means an automated and controlled way to move the code from the computer of the developer through different tests and quality checks to the production environment. </p>\n<p>There are multiple ways to achieve this (for example placing both backend and frontend code <a href=\"https://github.com/mars/heroku-cra-node\">to the same repository</a> ) but we will not go into those now. </p>\n<p>In some situations it may be sensible to deploy the frontend code as it's own application. With apps created with create-react-app it is <a href=\"https://github.com/mars/create-react-app-buildpack\">straightforward</a>.</p>\n<p>Current code of the backend can be found on <a href=\"https://github.com/fullstackopen-2019/part3-notes-backend/tree/part3-3\">Github</a>, in the branch <i>part3-3</i>. The changes in frontend code are in <i>part3-1</i> branch of the <a href=\"https://github.com/fullstackopen-2019/part2-notes/tree/part3-1\">frontend repository</a>.</p>\n</div>\n<div class=\"tasks\">\n<h3>Exercises</h3>\n<p>The following exercises don't require many lines of code. They can however be challenging, because you must understand exactly what is happening and where, and the configurations must be just right. </p>\n<h4>3.9 phonebook backend step9</h4>\n<p>Make the backend work with the frontend from the previous part. Do not implement the functionality for making changes to the phone numbers yet, that will be implemented in exercise 3.17. </p>\n<p>You will probably have to do some small changes to the frontend, at least to the URLs for the backend. Remember to keep the developer console open in your browser. If some HTTP requests fail, you should check from the <i>Network</i>-tab what is going on. Keep an eye on the backend's console as well. If you did not do the previous exercise, it is worth it to print the request data or <i>request.body</i> to the console in the event handler responsible for POST requests. </p>\n<h4>3.10 phonebook backend step10</h4>\n<p>Deploy the backend to the internet, for example to Heroku. </p>\n<p><strong>NB</strong> the command <em>heroku</em> works on the department's computers and the freshman laptops. If for some reason you cannot <a href=\"https://devcenter.heroku.com/articles/heroku-cli\">install</a> Heroku to your computer, you can use the command <a href=\"https://www.npmjs.com/package/heroku-cli\">npx heroku-cli</a>.</p>\n<p>Test the deployed backend with a browser and Postman or VS Code REST client to ensure it works. </p>\n<p><strong>PRO TIP:</strong> When you deploy your application to Heroku, it is worth it to at least in the beginning keep an eye on the logs of the heroku application <strong>AT ALL TIMES</strong> with the command <em>heroku logs -t</em>.</p>\n<p>The following is a log about one typical problem. Heroku cannot find application dependency <i>express</i>:</p>\n<picture><img src=\"/static/9c32d4d565c7179d84334ba086ed03b9/14be6/33.png\" srcset=\"/static/9c32d4d565c7179d84334ba086ed03b9/4cce7/33.png 200w,\n/static/9c32d4d565c7179d84334ba086ed03b9/bae5f/33.png 400w,\n/static/9c32d4d565c7179d84334ba086ed03b9/14be6/33.png 800w,\n/static/9c32d4d565c7179d84334ba086ed03b9/1b35a/33.png 1200w,\n/static/9c32d4d565c7179d84334ba086ed03b9/9ee03/33.png 1600w,\n/static/9c32d4d565c7179d84334ba086ed03b9/beddc/33.png 1610w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>The reason is that the option <i>--save</i> was forgotten when <i>express</i> was installed, so information about the dependency was not saved to the file <i>package.json</i>.</p>\n<p>Another typical problem is that the application is not configured to use the port set to environment variable <em>PORT</em>: </p>\n<picture><img src=\"/static/ca43fb98bc62fbd1d6a918b4d965274e/14be6/34.png\" srcset=\"/static/ca43fb98bc62fbd1d6a918b4d965274e/4cce7/34.png 200w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/bae5f/34.png 400w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/14be6/34.png 800w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/1b35a/34.png 1200w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/136ae/34.png 1598w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Create a README.md at the root of your repository, and add a link to your online application to it. </p>\n<h4>3.11 phonebook full stack</h4>\n<p>Generate a production build of your frontend, and add it to the internet application using the method introduced in this part. </p>\n<p><strong>NB</strong> Make sure the directory <i>build</i> is not gitignored</p>\n<p>Also make sure that the frontend still works locally. </p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/part-3-8ac7bc0fb2b7018a7853b00c454b2103.svg"},"part":3,"letter":"b","lang":"en"}}},"pageContext":{"part":3,"letter":"b","lang":"en"}}
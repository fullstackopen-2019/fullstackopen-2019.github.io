{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<h2>Tehtävät</h2>\n<p>Melkein kaikki osan 7 <a href=\"/teht%C3%A4v%C3%A4t#osa7\">tehtävistä</a> ovat koko kurssin sisältöä kertaavia, voit aloittaa tehtävien tekemisen vaikka heti, vain muutama tehtävistä edellyttää tämän osan teorian läpikäyntiä.</p>\n<h2>Webpack</h2>\n<p>React on ollut jossain määrin kuuluisa siitä, että sovelluskehityksen edellyttämien työkalujen konfigurointi on ollut hyvin hankalaa. Kiitos <a href=\"https://github.com/facebookincubator/create-react-app\">create-react-app</a>:in, sovelluskehitys Reactilla on kuitenkin nykyään tuskatonta, parempaa työskentelyflowta on tuskin ollut koskaan Javascriptillä tehtävässä selainpuolen sovelluskehityksessä.</p>\n<p>Emme voi kuitenkaan turvautua ikuisesti create-react-app:in magiaan ja nyt onkin aika selvittää mitä kaikkea taustalla on. Avainasemassa React-sovelluksen toimintakuntoon saattamisessa on <a href=\"https://webpack.js.org/\">webpack</a>-niminen työkalu.</p>\n<h3>bundlaus</h3>\n<p>Olemme toteuttaneet sovelluksia jakamalla koodin moduuleihin, joita on <em>importattu</em> niitä tarvitseviin paikkoihin. Vaikka ES6-moduulit ovatkin Javascript-standardissa määriteltyjä, ei mikään selain vielä osaa käsitellä moduuleihin jaettua koodia.</p>\n<p>Selainta varten moduuleissa oleva koodi <em>bundlataan</em>, eli siitä muodostetaan yksittäinen, kaiken koodin sisältävä tiedosto. Kun veimme Reactilla toteutetun frontendin tuotantoon osan 3 luvussa <a href=\"/osa3#frontendin-tuotantoversio\">Frontendin tuotantoversio</a>, suoritimme bundlauksen komennolla <em>npm run build</em>. Konepellin alla kyseinen npm-skripti suorittaa bundlauksen webpackia hyväksi käyttäen. Tuloksena on joukko hakemistoon <em>build</em> sijoitettavia tiedostoja:</p>\n<pre>\n├── asset-manifest.json\n├── favicon.ico\n├── index.html\n├── manifest.json\n├── service-worker.js\n└── static\n    ├── css\n    │   ├── main.1b1453df.css\n    │   └── main.1b1453df.css.map\n    └── js\n        ├── main.54f11b10.js\n        └── main.54f11b10.js.map\n</pre>\n<p>Hakemiston juuressa oleva sovelluksen \"päätiedosto\" <em>index.html</em> lataa <em>script</em>-tagin avulla bundlatun Javascript-tiedoston:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/css/main.1b1453df.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/main.54f11b10.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Kuten esimerkistä näemme, create-react-app:illa tehdyssä sovelluksessa bundlataan Javascriptin lisäksi sovelluksen CSS-määrittelyt tiedostoon <em>static/css/main.1b1453df.css</em></p>\n<p>Käytännössä bundlaus tapahtuu siten, että sovelluksen Javascriptille määritellään alkupiste, usein tiedosto <em>index.js</em>, ja bundlauksen yhteydessä webpack ottaa mukaan kaiken koodin mitä alkupiste importtaa, sekä importattujen koodien importtaamat koodit, jne.</p>\n<p>Koska osa importeista on kirjastoja, kuten React, Redux ja Axios, bundlattuun javascript-tiedostoon tulee myös kaikkien näiden sisältö.</p>\n<blockquote>\n<p>Vanha tapa jakaa sovelluksen koodi moneen tiedostoon perustui siihen, että <em>index.html</em> latasi kaikki sovelluksen tarvitsemat erilliset Javascript-tiedostot script-tagien avulla. Tämä on kuitenkin tehotonta, sillä jokaisen tiedoston lataaminen aiheuttaa pienen overheadin ja nykyään pääosin suositaankin koodin bundlaamista yksittäiseksi tiedostoksi.</p>\n</blockquote>\n<p>Tehdään nyt React-projektille sopiva webpack-konfiguraatio kokonaan käsin.</p>\n<p>Luodaan projektia varten hakemisto ja sen sisälle seuraavat hakemistot (dist ja src) sekä tiedostot:</p>\n<pre>\n├── dist\n├── package.json\n├── src\n│   └── index.js\n└── webpack.config.js\n</pre>\n<p>Tiedoston <em>package.json</em> sisältö voi olla esim. seuraava:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-osa7\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"practising webpack\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Asennetaan webpack komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev webpack webpack-cli</code></pre></div>\n<p>Webpackin toiminta konfiguroidaan tiedostoon <em>webpack.config.js</em>, laitetaan sen alustavaksi sisällöksi seuraava</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">const path <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n\nconst config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry: <span class=\"token string\">'./src/index.js'</span>,\n  output: <span class=\"token punctuation\">{</span>\n    path: path.resolve<span class=\"token punctuation\">(</span>__dirname, <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span>,\n    filename: <span class=\"token string\">'main.js'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\nmodule.exports <span class=\"token operator\">=</span> config</code></pre></div>\n<p>Määritellään sitten npm-skripti <em>build</em> jonka avulla bundlaus suoritetaan</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// <span class=\"token punctuation\">..</span>.\n<span class=\"token string\">\"scripts\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"build\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"webpack --mode=development\"</span>\n<span class=\"token punctuation\">}</span>,\n// <span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>Lisätään hieman koodia tiedostoon <em>src/index.js</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hello</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Kun nyt suoritamme komennon <em>npm run build</em> webpack bundlaa koodin. Tuloksena on hakemistoon <em>dist</em> sijoitettava tiedosto <em>main.js</em>:</p>\n<picture><img src=\"/static/6433076ef5df206c63279b982704150f/14be6/1.png\" srcset=\"/static/6433076ef5df206c63279b982704150f/4cce7/1.png 200w,\n/static/6433076ef5df206c63279b982704150f/bae5f/1.png 400w,\n/static/6433076ef5df206c63279b982704150f/14be6/1.png 800w,\n/static/6433076ef5df206c63279b982704150f/16a28/1.png 1136w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tiedostossa on paljon erikoisen näköistä tavaraa. Lopussa on mukana myös kirjoittamamme koodi.</p>\n<p>Lisätään hakemistoon <em>src</em> tiedosto <em>App.js</em> ja sille sisältö</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Importataan ja käytetään modulia <em>App</em> tiedostossa <em>index.js</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./App'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hello</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Kun nyt suoritamme bundlauksen komennolla <em>npm run build</em> huomaamme webpackin havainneen molemmat tiedostot:</p>\n<picture><img src=\"/static/21921fb9c9fb2d288aced172687b234f/14be6/2.png\" srcset=\"/static/21921fb9c9fb2d288aced172687b234f/4cce7/2.png 200w,\n/static/21921fb9c9fb2d288aced172687b234f/bae5f/2.png 400w,\n/static/21921fb9c9fb2d288aced172687b234f/14be6/2.png 800w,\n/static/21921fb9c9fb2d288aced172687b234f/0ab6d/2.png 1138w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Kirjoittamamme koodi löytyy melko kryptisesti muotoiltuna bundlen lopussa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/***/</span> <span class=\"token string\">\"./src/App.js\"</span><span class=\"token punctuation\">:</span>\n<span class=\"token comment\">/*!********************!*\\\n  !*** ./src/App.js ***!\n  \\********************/</span>\n<span class=\"token comment\">/*! exports provided: default */</span>\n<span class=\"token comment\">/***/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">,</span> __webpack_exports__<span class=\"token punctuation\">,</span> __webpack_require__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"__webpack_require__.r(__webpack_exports__);\\nconst App = () => {\\n  return null;\\n};\\n\\n/* harmony default export */ __webpack_exports__[\\\"default\\\"] = (App);\\n\\n//# sourceURL=webpack:///./src/App.js?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/***/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token comment\">/***/</span> <span class=\"token string\">\"./src/index.js\"</span><span class=\"token punctuation\">:</span>\n<span class=\"token comment\">/*!**********************!*\\\n  !*** ./src/index.js ***!\n  \\**********************/</span>\n<span class=\"token comment\">/*! no exports provided */</span>\n<span class=\"token comment\">/***/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">,</span> __webpack_exports__<span class=\"token punctuation\">,</span> __webpack_require__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _App__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./App */ \\\"./src/App.js\\\");\\n\\n\\nconst hello = name => {\\n  console.log(`hello ${name}`);\\n};\\n\\nObject(_App__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"])();\\n\\n//# sourceURL=webpack:///./src/index.js?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Konfiguraatiotiedosto</h3>\n<p>Katsotaan nyt tarkemmin konfiguraation <em>webpack.config.js</em> tämänhetkistä sisältöä:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'main.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Konfiguraatio on Javascriptia ja tapahtuu eksporttaamalla määrittelyt sisältävä olio Noden moduulisyntaksilla.</p>\n<p>Tämän hetkinen minimaalinen määrittely on aika ilmeinen, kenttä <a href=\"https://webpack.js.org/concepts/#entry\">entry</a> kertoo sen tiedoston, mistä bundlaus aloitetaan.</p>\n<p>Kenttä <a href=\"https://webpack.js.org/concepts/#output\">output</a> taas kertoo minne muodostettu bundle sijoitetaan. Kohdehakemisto täytyy määritellä <em>absoluuttisena polkuna</em>, se taas onnistuu helposti <a href=\"https://nodejs.org/docs/latest-v8.x/api/path.html#path_path_resolve_paths\">path.resolve</a>-metodilla. <a href=\"https://nodejs.org/docs/latest/api/globals.html#globals_dirname\">__dirname</a> on Noden globaali muuttuja, joka viittaa nykyiseen hakemistoon.</p>\n<h3>Webpack 4</h3>\n<p>Helmikuun viimeisten päivien aikana julkaistu Webpackin versio 4 on vähentänyt välttämättömän konfiguroinnin määrää määrittelemällä Webpackille joukon oletusarvoisia konfiguraatioita.</p>\n<p>Konfiguraatiossamme <em>entryllä</em> ja <em>outputilla</em> on niiden oletusarvo, eli voisimme myös jättää ne määrittelemättä, ja tiedoston <em>webpack.config.js</em> sisällöksi kävisi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Jätämme kuitenkin <em>entryn</em> ja <em>outputin</em> määrittelyt tiedostoon.</p>\n<h3>Reactin bundlaaminen</h3>\n<p>Muutetaan sitten sovellus minimalistiseksi React-sovellukseksi. Asennetaan tarvittavat kirjastot</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save react react-dom</code></pre></div>\n<p>Liitetään tavanomaiset loitsut tiedostoon <em>index.js</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./App'</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ja muutetaan <em>App.js</em> muotoon</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import React from &#39;react&#39;\n\nconst App = () =&gt; (\n  &lt;div&gt;hello webpack&lt;/div&gt;\n)\n\nexport default App</code></pre></div>\n<p>Tarvitsemme sovellukselle myös \"pääsivuna\" toimivan tiedoston <em>dist/index.html</em> joka lataa <em>script</em>-tagin avulla bundlatun Javascriptin:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>./main.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Kun bundlaamme sovelluksen, törmäämme kuitenkin ongelmaan</p>\n<picture><img src=\"/static/01bbf01876bbaa3d005ed18eb267d0b4/14be6/3.png\" srcset=\"/static/01bbf01876bbaa3d005ed18eb267d0b4/4cce7/3.png 200w,\n/static/01bbf01876bbaa3d005ed18eb267d0b4/bae5f/3.png 400w,\n/static/01bbf01876bbaa3d005ed18eb267d0b4/14be6/3.png 800w,\n/static/01bbf01876bbaa3d005ed18eb267d0b4/ea1cd/3.png 1130w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<h3>Loaderit</h3>\n<p>Webpack mainitsee että saatamme tarvita <em>loaderin</em> tiedoston <em>App.js</em> käsittelyyn. Webpack ymmärtää itse vain Javascriptia ja vaikka se saattaa meiltä matkan varrella olla unohtunutkin, käytämme Reactia ohjelmoidessamme <a href=\"https://facebook.github.io/jsx/\">JSX</a>:ää näkymien renderöintiin, eli esim. seuraava</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const App = () =&gt; (\n  &lt;div&gt;hello webpack&lt;/div&gt;\n)</code></pre></div>\n<p>ei ole \"normaalia\" Javascriptia, vaan JSX:n tarjoama syntaktinen oikotie määritellä <em>div</em>-tagiä vastaava React-elementti.</p>\n<p><a href=\"https://webpack.js.org/concepts/loaders/\">Loaderien</a> avulla on mahdollista kertoa webpackille miten tiedostot tulee käsitellä ennen niiden bundlausta.</p>\n<p>Määritellään projektiimme Reactin käyttämän JSX:n normaaliksi Javascriptiksi muuntava loaderi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'main.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n        loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Loaderit määritellään kentän <em>module</em> alle sijoitettavaan taulukkoon <em>rules</em>.</p>\n<p>Yksittäisen loaderin määrittely on kolmiosainen:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Kenttä <em>test</em> määrittelee että käsitellään <em>.js</em>-päätteisiä tiedostoja, <em>loader</em> kertoo että käsittely tapahtuu <a href=\"https://github.com/babel/babel-loader\">babel-loader</a>:illa. Kenttä <em>query</em> taas antaa loaderille sen toimintaa ohjaavia parametreja.</p>\n<p>Asennetaan loader ja sen tarvitsemat kirjastot <em>kehitysaikaiseksi riippuvuudeksi</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev babel-core babel-loader babel-preset-react</code></pre></div>\n<p>Nyt bundlaus onnistuu.</p>\n<p>Jos katsomme bundlattua koodia, huomaamme, että komponentti <em>App</em> on muuttunut muotoon</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  react__WEBPACK_IMPORTED_MODULE_0___default<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'hello webpack'</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Eli JSX-syntaksin sijaan komponentit luodaan pelkällä Javascriptilla käyttäen Reactin funktiota <a href=\"https://reactjs.org/docs/react-without-jsx.html\">createElement</a>.</p>\n<p>Sovellusta voi nyt kokeilla avaamalla tiedoston dist/index.html* selaimen _open file* -toiminnolla:</p>\n<picture><img src=\"/static/c186187dbead4d9f525df4955439913b/14be6/4.png\" srcset=\"/static/c186187dbead4d9f525df4955439913b/4cce7/4.png 200w,\n/static/c186187dbead4d9f525df4955439913b/bae5f/4.png 400w,\n/static/c186187dbead4d9f525df4955439913b/14be6/4.png 800w,\n/static/c186187dbead4d9f525df4955439913b/1b35a/4.png 1200w,\n/static/c186187dbead4d9f525df4955439913b/0b406/4.png 1388w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tässä on jo melkein kaikki mitä tarvitsemme React-sovelluskehitykseen.</p>\n<h3>Transpilaus</h3>\n<p>Prosessista, joka muuttaa Javascriptia muodosta toiseen käytetään englanninkielistä termiä <a href=\"https://en.wiktionary.org/wiki/transpile\">transpiling</a>, joka taas on termi, joka viittaa koodin kääntämiseen (compile) sitä muuntamalla (transform). Suomenkielisen termin puuttuessa käytämme prosessista tällä kurssilla nimitystä <em>transpilaus</em>.</p>\n<p>Edellisen luvun konfiguraation avulla siis <em>transpiloimme</em> JSX:ää sisältävän Javascriptin normaaliksi Javascriptiksi tämän hetken johtavan työkalun <a href=\"https://babeljs.io/\">babelin</a> avulla.</p>\n<p>Kuten osassa 1 jo mainittiin, läheskään kaikki selaimet eivät vielä osaa Javascriptin uusimpien versioiden ES6:n ja ES7:n ominaisuuksia ja tämän takia koodi yleensä transpiloidaan käyttämään vanhempaa Javascript-syntaksia ES5:ttä.</p>\n<p>Babelin suorittama transpilointiprosessi määritellään <em>pluginien</em> avulla. Käytännössä useimmiten käytetään valmiita <a href=\"https://babeljs.io/docs/plugins/\">presetejä</a>, eli useamman sopivan pluginin joukkoja.</p>\n<p>Tällä hetkellä sovelluksemme transpiloinnissa käytetään presetiä <a href=\"https://babeljs.io/docs/plugins/preset-react/\">react</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Otetaan käyttöön preset <a href=\"https://babeljs.io/docs/plugins/preset-env/\">env</a>, joka sisältää kaiken hyödyllisen, minkä avulla uusimman standardin mukainen koodi saadaan transpiloitua ES5-standardin mukaiseksi koodiksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'env'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Preset asennetaan komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm install babel<span class=\"token operator\">-</span>preset<span class=\"token operator\">-</span>env <span class=\"token operator\">--</span>save<span class=\"token operator\">-</span>dev</code></pre></div>\n<p>Kun nyt transpiloimme koodin, muuttuu se vanhan koulukunnan Javascriptiksi. Komponentin <em>App</em> määrittely näyttää seuraavalta:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> _react2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hello webpack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Muuttujan määrittely tapahtuu avainsanan <em>var</em> avulla, sillä ES5 ei tunne avainsanaa <em>const</em>. Myöskään nuolifunktiot eivät ole käytössä, joten funktiomäärittely käyttää avainsanaa <em>function</em>.</p>\n<h3>CSS</h3>\n<p>Lisätään sovellukseemme hieman CSS:ää. Tehdään tiedosto <em>src/index.css</em></p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 10<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #dee8e4<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Määritellään tyyli käytettäväksi komponentissa <em>App</em></p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const App = () =&gt; (\n  &lt;div className=&quot;container&quot;&gt;\n    hello webpack\n  &lt;/div&gt;\n)</code></pre></div>\n<p>ja importataan se tiedostossa <em>index.js</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">'./index.css'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Transpilointi hajoaa, ja CSS:ää varten onkin otettava käyttöön <a href=\"https://webpack.js.org/loaders/css-loader/\">css</a>- ja <a href=\"https://webpack.js.org/loaders/style-loader/\">style</a>-loaderit:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n      query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'env'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.css$/</span><span class=\"token punctuation\">,</span>\n      loaders<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://webpack.js.org/loaders/css-loader/\">css-loaderin</a> tehtävänä on ladata <em>CSS</em>-tiedostot, ja <a href=\"https://webpack.js.org/loaders/style-loader/\">style-loader</a> generoi koodiin CSS:t sisältävän <em>style</em>-elementin.</p>\n<p>Näin konfiguroituna CSS-määrittelyt sisällytetään sovelluksen Javascriptin sisältävään tiedostoon <em>main.js</em>. Sovelluksen päätiedostossa <em>index.html</em> ei siis ole tarvetta erikseen ladata CSS:ää.</p>\n<p>CSS voidaan tarpeen vaatiessa myös generoida omaan tiedostoonsa esim. <a href=\"https://github.com/webpack-contrib/mini-css-extract-plugin\">mini-css-extract-pluginin</a> avulla.</p>\n<p>Kun loaderit asennetaan</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> style-loader css-loader --save-dev</code></pre></div>\n<p>bundlaus toimii taas ja sovellus saa uudet tyylit.</p>\n<h3>Webpack-dev-server</h3>\n<p>Sovelluskehitys onnistuu jo, mutta development workflow on suorastaan hirveä (alkaa jo muistuttaa Javalla tapahtuvaa sovelluskehitystä...), muutosten jälkeen koodin on bundlattava ja selain uudelleenladattava jos haluamme testata koodia.</p>\n<p>Ratkaisun tarjoaa <a href=\"https://webpack.js.org/guides/development/#using-webpack-dev-server\">webpack-dev-server</a>. Asennetaan se komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev webpack-dev-server</code></pre></div>\n<p>Määritellään dev-serverin käynnistävä npm-skripti:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">{</span>\n  // <span class=\"token punctuation\">..</span>.\n  <span class=\"token string\">\"scripts\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"build\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"webpack --mode=development\"</span>,\n    <span class=\"token string\">\"start\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"webpack-dev-server --mode=development\"</span>\n  <span class=\"token punctuation\">}</span>,\n  // <span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Lisätään tiedostoon <em>webpack.config.js</em> kenttä <em>devServer</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'main.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  devServer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    contentBase<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    compress<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    port<span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Komento <em>npm start</em> käynnistää nyt dev-serverin porttiin, eli sovelluskehitys tapahtuu avaamalla tuttuun tapaan selain osoitteeseen <a href=\"http://localhost:3000\">http://localhost:3000</a>. Kun teemme koodiin muutoksia, reloadaa selain automaattisesti itsensä.</p>\n<p>Päivitysprosessi on nopea, dev-serveriä käytettäessä webpack ei bundlaa koodia normaaliin tapaan tiedostoksi <em>main.js</em>, bundlauksen tuotos on olemassa ainoastaan keskusmuistissa.</p>\n<p>Laajennetaan koodia muuttamalla komponentin <em>App</em> määrittelyä seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">class App extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      counter: 0\n    }\n  }\n\n  render() {\n    return (\n      &lt;div className=&quot;container&quot;&gt;\n        &lt;p&gt;hello webpack {this.state.counter} clicks&lt;/p&gt;\n        &lt;button onClick={()=&gt;this.setState({counter: this.state.counter+1})}&gt;click&lt;/button&gt;\n      &lt;/div&gt;\n    )\n  }\n}</code></pre></div>\n<p>Kannattaa huomata, että virheviestit eivät renderöidy selaimeen kuten create-react-app:illa tehdyissä sovelluksissa, eli on seurattava tarkasti konsolia:</p>\n<picture><img src=\"/static/5fc608cdd8114f98fa7c04cc38ca024e/14be6/5.png\" srcset=\"/static/5fc608cdd8114f98fa7c04cc38ca024e/4cce7/5.png 200w,\n/static/5fc608cdd8114f98fa7c04cc38ca024e/bae5f/5.png 400w,\n/static/5fc608cdd8114f98fa7c04cc38ca024e/14be6/5.png 800w,\n/static/5fc608cdd8114f98fa7c04cc38ca024e/1b35a/5.png 1200w,\n/static/5fc608cdd8114f98fa7c04cc38ca024e/cd43c/5.png 1536w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Sovellus toimii hyvin ja kehitys on melko sujuvaa.</p>\n<h3>Sourcemappaus</h3>\n<p>Erotetaan napin klikkauksenkäsittelijä omaksi funktioksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">class App extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      counter: 0\n    }\n  }\n\n  onClick() {\n    this.setState({ counter: this.state.counter + 1 })\n  }\n\n  render() {\n    return (\n      &lt;div className=&quot;container&quot;&gt;\n        &lt;p&gt;hello webpack {this.state.counter} clicks&lt;/p&gt;\n        &lt;button onClick={this.onClick}&gt;click&lt;/button&gt;\n      &lt;/div&gt;\n    )\n  }\n}</code></pre></div>\n<p>Sovellus ei enää toimi, ja konsoli kertoo virheestä</p>\n<picture><img src=\"/static/0e74ac54a4a53db38281a9a4204f648d/14be6/6.png\" srcset=\"/static/0e74ac54a4a53db38281a9a4204f648d/4cce7/6.png 200w,\n/static/0e74ac54a4a53db38281a9a4204f648d/bae5f/6.png 400w,\n/static/0e74ac54a4a53db38281a9a4204f648d/14be6/6.png 800w,\n/static/0e74ac54a4a53db38281a9a4204f648d/1b35a/6.png 1200w,\n/static/0e74ac54a4a53db38281a9a4204f648d/ea804/6.png 1488w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tiedämme tietenkin nyt että virhe on metodissa onClick, mutta jos olisi kyse suuremmasta sovelluksesta, on virheilmoitus sikäli hyvin ikävä, että sen ilmoittama paikka:</p>\n<pre>\nApp.js:38 Uncaught TypeError: Cannot read property 'setState' of undefined\n    at onClick (App.js:38)\n</pre>\n<p>ei vastaa alkuperäisen koodin virheen sijaintia. Jos klikkaamme virheilmoitusta, huomaamme, että näytettävä koodi on jotain ihan muuta kuin kirjoittamamme koodi:</p>\n<picture><img src=\"/static/049b912cf174542f1b7c79f34aeb7f6a/14be6/6a.png\" srcset=\"/static/049b912cf174542f1b7c79f34aeb7f6a/4cce7/6a.png 200w,\n/static/049b912cf174542f1b7c79f34aeb7f6a/bae5f/6a.png 400w,\n/static/049b912cf174542f1b7c79f34aeb7f6a/14be6/6a.png 800w,\n/static/049b912cf174542f1b7c79f34aeb7f6a/1b35a/6a.png 1200w,\n/static/049b912cf174542f1b7c79f34aeb7f6a/9ee03/6a.png 1600w,\n/static/049b912cf174542f1b7c79f34aeb7f6a/ee155/6a.png 1764w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Haluamme tietenkin, että virheilmoitusten yhteydessä näytetään kirjoittamamme koodi.</p>\n<p>Korjaus on onneksi hyvin helppo, pyydetään webpackia generoimaan bundlelle ns. <a href=\"https://webpack.js.org/configuration/devtool/\">source map</a>, jonka avulla bundlea suoritettaessa tapahtuva virhe on mahdollista <em>mäpätä</em> alkuperäisen koodin vastaavaan kohtaan.</p>\n<p>Source map saadaan generoitua lisäämällä konfiguraatioon kenttä <em>devtool</em> ja sen arvoksi 'source-map':</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  devServer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  devtool<span class=\"token punctuation\">:</span> <span class=\"token string\">'source-map'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Konfiguraatioiden muuttuessa webpack tulee käynnistää uudelleen, on tosin mahdollista konfiguroida webpack tarkkailemaan konfiguraatioiden muutoksia, mutta emme tee sitä.</p>\n<p>Nyt virheilmoitus on hyvä</p>\n<picture><img src=\"/static/0476f60ccac3298b85b6ab007eea200b/14be6/7.png\" srcset=\"/static/0476f60ccac3298b85b6ab007eea200b/4cce7/7.png 200w,\n/static/0476f60ccac3298b85b6ab007eea200b/bae5f/7.png 400w,\n/static/0476f60ccac3298b85b6ab007eea200b/14be6/7.png 800w,\n/static/0476f60ccac3298b85b6ab007eea200b/1b35a/7.png 1200w,\n/static/0476f60ccac3298b85b6ab007eea200b/9ee03/7.png 1600w,\n/static/0476f60ccac3298b85b6ab007eea200b/cac2e/7.png 1930w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Source mapin käyttö mahdollistaa myös chromen debuggerin luontevan käytön</p>\n<picture><img src=\"/static/51090b992f6d4d497136b9edf4b17d9a/14be6/8.png\" srcset=\"/static/51090b992f6d4d497136b9edf4b17d9a/4cce7/8.png 200w,\n/static/51090b992f6d4d497136b9edf4b17d9a/bae5f/8.png 400w,\n/static/51090b992f6d4d497136b9edf4b17d9a/14be6/8.png 800w,\n/static/51090b992f6d4d497136b9edf4b17d9a/1b35a/8.png 1200w,\n/static/51090b992f6d4d497136b9edf4b17d9a/9ee03/8.png 1600w,\n/static/51090b992f6d4d497136b9edf4b17d9a/1888a/8.png 1936w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Kyseinen virhe on siis jo <a href=\"/osa1#metodien-k%C3%A4ytt%C3%B6-ja-this\">osasta 1</a> tuttu this:in kadottaminen. Korjataan ongelma määrittelemällä metodi uudelleen meille jo kovin tutulla syntaksilla:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">onClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> counter<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>counter <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Tästä aiheutuu kuitenkin virheilmoitus</p>\n<picture><img src=\"/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/14be6/9.png\" srcset=\"/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/4cce7/9.png 200w,\n/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/bae5f/9.png 400w,\n/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/14be6/9.png 800w,\n/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/1b35a/9.png 1200w,\n/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/9ee03/9.png 1600w,\n/static/7f7dfeaa4c6c64ce9566d7d08f18fc61/66f7e/9.png 1866w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Virhe johtuu siitä, että käyttämämme syntaksi ei ole vielä mukana Javascriptin uusimmassa standardissa ES7. Saamme syntaksin käyttöön asentamalla <a href=\"https://babeljs.io/docs/plugins/transform-class-properties/\">transform-class-properties</a>-pluginin komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> babel-plugin-transform-class-properties --save-dev</code></pre></div>\n<p>ja kehottamalla <em>babel-loader</em>:ia käyttämään pluginia:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'env'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'babel-plugin-transform-class-properties'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Koodin minifiointi</h3>\n<p>Kun sovellus viedään tuotantoon, on siis käytössä tiedostoon <em>main.js</em> webpackin generoima koodi. Vaikka sovelluksemme sisältää omaa koodia vain muutaman rivin, on tiedoston <em>main.js</em> koko 557450 tavua, sillä se sisältää myös kaiken React-kirjaston koodin. Tiedoston koollahan on sikäli väliä, että selain joutuu lataamaan tiedoston kun sovellusta aletaan käyttämään. Nopeilla internetyhteyksillä 557450 tavua ei sinänsä ole ongelma, mutta jos mukaan sisällytetään enemmän kirjastoja, alkaa sovelluksen lataaminen pikkuhiljaa hidastua etenkin mobiilikäytössä.</p>\n<p>Jos tiedoston sisältöä tarkastelee, huomaa että sitä voisi optimoida huomattavasti koon suhteen esim. poistamalla kommentit. Tiedostoa ei kuitenkaan kannata lähteä optimoimaan käsin, sillä tarkoitusta varten on olemassa monia työkaluja.</p>\n<p>Javascript-tiedostojen optimointiprosessista käytetään nimitystä <em>minifiointi</em>. Alan johtava työkalu tällä hetkellä lienee <a href=\"http://lisperator.net/uglifyjs/\">UglifyJS</a>.</p>\n<p>Webpackin versiosta 4 alkaen pluginia ei ole tarvinnut konfiguroida erikseen, riittää että muutetaan tiedoston <em>package.json</em> määrittelyä siten, että koodin bundlaus tapahtuu <em>production</em>-moodissa:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-osa7\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"practising webpack\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack --mode=production\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-dev-server --mode=development\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    // ...\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    // ...\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Kun sovellus bundlataan uudelleen, pienenee tuloksena oleva <em>main.js</em> mukavasti</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">-rw-r--r--  1 mluukkai  984178727  101944 Mar  3 21:29 main.js</code></pre></div>\n<p>Minifioinnin lopputulos on kuin vanhan liiton c-koodia, kommentit ja jopa turhat välilyönnit ja rivinvaihdot on poistettu ja muuttujanimet ovat yksikirjaimisia:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> e<span class=\"token operator\">=</span><span class=\"token function\">u</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>d<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>c<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>t<span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>s<span class=\"token operator\">=</span>c<span class=\"token punctuation\">,</span>c<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token operator\">++</span>f<span class=\"token operator\">&lt;</span>t<span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>s<span class=\"token operator\">&amp;&amp;</span>s<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>f<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>t<span class=\"token operator\">=</span>c<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">}</span>s<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>d<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>o<span class=\"token operator\">===</span>clearTimeout<span class=\"token punctuation\">)</span><span class=\"token keyword\">return</span> <span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>o<span class=\"token operator\">===</span>l<span class=\"token operator\">||</span><span class=\"token operator\">!</span>o<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span>clearTimeout<span class=\"token punctuation\">)</span><span class=\"token keyword\">return</span> o<span class=\"token operator\">=</span>clearTimeout<span class=\"token punctuation\">,</span><span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span><span class=\"token function\">o</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">return</span> o<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">return</span> o<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>a<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">nextTick</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">.</span>length<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">.</span>length<span class=\"token operator\">></span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Sovelluskehitys- ja tuotantokonfiguraatio</h3>\n<p>Lisätään sovellukselle backend. Käytetään jo tutuksi käynyttä muistiinpanoja tarjoavaa palvelua.</p>\n<p>Talletetaan seuraava sisältö tiedostoon <em>db.json</em></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"notes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"important\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HTML on helppoa\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5a3b8481bb01f9cb00ccb4a9\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"important\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Mongo osaa tallettaa oliot\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5a3b920a61e8c8d3f484bdd0\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tarkoituksena on konfiguroida sovellus webpackin avulla siten, että paikallisesti sovellusta kehitettäessä käytetään backendina portissa 3001 toimivaa json-serveriä.</p>\n<p>Bundlattu tiedosto laitetaan sitten käyttämään todellista, osoitteessa <a href=\"https://radiant-plateau-25399.herokuapp.com/api/notes\">https://radiant-plateau-25399.herokuapp.com/api/notes</a> olevaa backendia.</p>\n<p>Asennetaan <em>axios</em>, käynnistetään json-server ja muokataan komponenttia <em>App</em> seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">class App extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      counter: 0,\n      noteCount: 0\n    }\n  }\n\n  componentDidMount() {\n    axios.get(&#39;http://localhost:3001/notes&#39;).then(result =&gt; {\n      this.setState({ noteCount: result.data.length })\n    })\n  }\n\n  onClick = () =&gt; {\n    this.setState({ counter: this.state.counter + 1 })\n  }\n\n  render() {\n    return (\n      &lt;div className=&quot;container&quot;&gt;\n        &lt;p&gt;hello webpack {this.state.counter} clicks&lt;/p&gt;\n        &lt;button onClick={this.onClick}&gt;click&lt;/button&gt;\n        &lt;p&gt;{this.state.noteCount} notes in server&lt;/p&gt;\n      &lt;/div&gt;\n    )\n  }\n}</code></pre></div>\n<p>Koodissa on nyt kovakoodattuna sovelluskehityksessä käytettävän palvelimen osoite. Miten saamme osoitteen hallitusti muutettua osoittamaan internetissä olevaan backendiin bundlatessamme koodin?</p>\n<p>Muutetaan <em>webpack.config.js</em> oliosta <a href=\"https://webpack.js.org/configuration/configuration-types/#exporting-a-function\">funktioksi</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">config</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n    output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    devServer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    devtool<span class=\"token punctuation\">:</span> <span class=\"token string\">'source-map'</span><span class=\"token punctuation\">,</span>\n    module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Määrittely on muuten täysin sama, mutta aiemmin eksportattu olio on nyt määritellyn funktion paluuarvo. Funktio saa parametrit <em>env</em> ja <em>argv</em>, joista jälkimmäisen avulla saamme selville npm-skriptissä määritellyn <em>moden</em>.</p>\n<p>Webpackin <a href=\"https://webpack.js.org/plugins/define-plugin/\">DefinePlugin</a>:in avulla voimme määritellä globaaleja <em>vakioarvoja</em>, joita on mahdollista käyttää bundlattavassa koodissa. Määritellään nyt vakio <em>BACKEND</em>URL_, joka saa eri arvon riippuen siitä ollaanko kehitysympäristössä vai tehdäänkö tuotantoon sopivaa bundlea:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">const path <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\nconst webpack <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">)</span>\n\nconst config <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>env, argv<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  console.log<span class=\"token punctuation\">(</span><span class=\"token string\">'argv'</span>, argv.mode<span class=\"token punctuation\">)</span>\n\n  const backend_url <span class=\"token operator\">=</span> argv.mode <span class=\"token operator\">==</span><span class=\"token operator\">=</span> <span class=\"token string\">'production'</span>\n    ? <span class=\"token string\">'https://radiant-plateau-25399.herokuapp.com/api/notes'</span>\n    <span class=\"token keyword\">:</span> <span class=\"token string\">'http://localhost:3001/notes'</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    entry: <span class=\"token string\">'./src/index.js'</span>,\n    output: <span class=\"token punctuation\">{</span>\n      path: path.resolve<span class=\"token punctuation\">(</span>__dirname, <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span>,\n      filename: <span class=\"token string\">'main.js'</span>\n    <span class=\"token punctuation\">}</span>,\n    devServer: <span class=\"token punctuation\">{</span>\n      contentBase: path.resolve<span class=\"token punctuation\">(</span>__dirname, <span class=\"token string\">\"dist\"</span><span class=\"token punctuation\">)</span>,\n      compress: true,\n      port: 3000\n    <span class=\"token punctuation\">}</span>,\n    devtool: <span class=\"token string\">'source-map'</span>,\n    module: <span class=\"token punctuation\">{</span>\n      // <span class=\"token punctuation\">..</span>.\n    <span class=\"token punctuation\">}</span>,\n    plugins: <span class=\"token punctuation\">[</span>\n      new webpack.DefinePlugin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        BACKEND_URL: JSON.stringify<span class=\"token punctuation\">(</span>backend_url<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\nmodule.exports <span class=\"token operator\">=</span> config</code></pre></div>\n<p>Määriteltyä vakiota käytetään koodissa seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token constant\">BACKEND_URL</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>noteCount<span class=\"token punctuation\">:</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Jos kehitys- ja tuotantokonfiguraatio eriytyvät paljon, saattaa olla hyvä idea <a href=\"https://webpack.js.org/guides/production/\">eriyttää konfiguraatiot</a> omiin tiedostoihinsa.</p>\n<p>Tuotantoversiota eli bundlattua sovellusta on mahdollista kokeilla lokaalisti suorittamalla komento</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx static-server</code></pre></div>\n<p>hakemistossa <em>dist</em> jolloin sovellus käynnistyy oletusarvoisesti osoitteeseen <a href=\"http://localhost:9080\">http://localhost:9080</a>.</p>\n<h3>Polyfill</h3>\n<p>Sovelluksemme on valmis ja toimii muiden selaimien kohtuullisen uusilla versiolla, mutta Internet Explorerilla sovellus ei toimi. Syynä tähän on se, että <em>axiosin</em> ansiosta koodissa käytetään <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\">Promiseja</a>, mikään IE:n versio ei kuitenkaan niitä tue:</p>\n<picture><img src=\"/static/c35b13a507393cc2c137aefd928d7e77/14be6/13.png\" srcset=\"/static/c35b13a507393cc2c137aefd928d7e77/4cce7/13.png 200w,\n/static/c35b13a507393cc2c137aefd928d7e77/bae5f/13.png 400w,\n/static/c35b13a507393cc2c137aefd928d7e77/14be6/13.png 800w,\n/static/c35b13a507393cc2c137aefd928d7e77/1b35a/13.png 1200w,\n/static/c35b13a507393cc2c137aefd928d7e77/8e7a2/13.png 1584w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>On paljon muutakin standardissa määriteltyjä asioita, joita IE ei tue, esim. niinkin harmiton komento kuin taulukoiden <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find\">find</a> ylittää IE:n kyvyt:</p>\n<picture><img src=\"/static/71ecbdcc237ac95419fc4e8dde2aa813/14be6/14.png\" srcset=\"/static/71ecbdcc237ac95419fc4e8dde2aa813/4cce7/14.png 200w,\n/static/71ecbdcc237ac95419fc4e8dde2aa813/bae5f/14.png 400w,\n/static/71ecbdcc237ac95419fc4e8dde2aa813/14be6/14.png 800w,\n/static/71ecbdcc237ac95419fc4e8dde2aa813/1b35a/14.png 1200w,\n/static/71ecbdcc237ac95419fc4e8dde2aa813/f0a3f/14.png 1586w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tälläisessä tilanteessa normaali koodin transpilointi ei auta, sillä transpiloinnissa koodia käännetään uudemmasta Javascript-syntaksista vanhempaan, selaimien paremmin tukemaan syntaksiin. Promiset ovat syntaktisesti täysin IE:n ymmärrettävissä, IE:ltä vain puuttuu toteutus promisesta, samoin on tilanne taulukoiden suhteen, IE:llä taulukoiden <em>find</em> on arvoltaan <em>undefined</em>.</p>\n<p>Jos haluamme sovelluksen IE-yhteensopivaksi, tarvitsemme <a href=\"https://remysharp.com/2010/10/08/what-is-a-polyfill\">polyfilliä</a>, eli koodia, joka lisää puuttuvan toiminnallisuuden vanhempiin selaimiin.</p>\n<p>Polyfillaus on mahdollista hoitaa <a href=\"https://babeljs.io/docs/usage/polyfill/\">Webpackin ja Babelin avulla</a> tai asentamalla yksi monista tarjolla olevista polyfill-kirjastoista.</p>\n<p>Esim. kirjaston <a href=\"https://www.npmjs.com/package/promise-polyfill\">promise-polyfill</a> tarjoaman polyfillin käyttö on todella helppoa, koodiin lisätään seuraava:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> PromisePolyfill <span class=\"token keyword\">from</span> <span class=\"token string\">'promise-polyfill'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>Promise<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  window<span class=\"token punctuation\">.</span>Promise <span class=\"token operator\">=</span> PromisePolyfill<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Jos globaalia <em>Promise</em>-olioa ei ole olemassa, eli selain ei tue promiseja, sijoitetaan polyfillattu promise globaaliin muuttujaan. Jos polyfillattu promise on hyvin toteutettu, muun koodin pitäisi toimia ilman ongelmia.</p>\n<p>Kattavahko lista olemassaolevista polyfilleistä löytyy <a href=\"https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills\">täältä</a>.</p>\n<p>Selaimien yhteensopivuus käytettävien API:en suhteen kannattaakin tarkistaa esim. <a href=\"https://caniuse.com\">https://caniuse.com</a>-sivustolta tai <a href=\"https://developer.mozilla.org/en-US/\">Mozillan sivuilta</a>.</p>\n<h3>Eject</h3>\n<p>Create-react-app käyttää taustalla webpackia. Jos peruskonfiguraatio ei riitä, on projektit mahdollista <a href=\"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#npm-run-eject\">ejektoida</a>, jolloin kaikki konepellin alla oleva magia häviää, ja konfiguraatiot tallettuvat hakemistoon <em>config</em> ja muokattuun <em>package.json</em>-tiedostoon.</p>\n<p>Jos create-react-app:illa tehdyn sovelluksen ejektoi, paluuta ei ole, sen jälkeen kaikesta konfiguroinnista on huolehdittava itse. Konfiguraatiot eivät ole triviaaleimmasta päästä ja create-react-appin ja ejektoinnin sijaan parempi vaihtoehto saattaa joskus olla tehdä itse koko webpack-konfiguraatio.</p>\n<p>Ejektoidun sovelluksen konfiguraatioiden lukeminen on suositeltavaa ja sangen opettavaista!</p>\n<h2>Lisää tyyleistä</h2>\n<p>Osissa 2 ja 6 on jo katsottu muutamaa tapaa tyylien lisäämiseen eli vanhan koulukunnan <a href=\"/osa2#tyylien-lis%C3%A4%C3%A4minen\">yksittäistä CSS</a>-tiedostoa, <a href=\"/osa6#inline-tyylit\">inline-tyylejä</a> ja <a href=\"/osa6#valmiit-k%C3%A4ytt%C3%B6liittym%C3%A4tyylikirjastot\">UI-frameworkien</a> kuten Bootstrapin käyttöä.</p>\n<p>Tapoja on <a href=\"https://survivejs.com/react/advanced-techniques/styling-react/\">monia muitakin</a>, katsotaan vielä lyhyestä kahta tapaa.</p>\n<h3>CSS-moduulit</h3>\n<p>Yksi CSS:n keskeisistä ongelmista on se, että CSS-määrittelyt ovat <em>globaaleja</em>. Suurissa tai jo keskikokoisissakin sovelluksissa tämä aiheuttaa ongelmia, sillä tiettyihin komponentteihin vaikuttavat monissa paikoissa määritellyt tyylit ja lopputulos voi olla vaikeasti ennakoitavissa.</p>\n<p>Laitoksen <a href=\"https://www.cs.helsinki.fi/courses\">kurssilistasivun</a> alaosassa on itseasiassa eräs ilmentymä tälläisestä ikävästä bugista</p>\n<picture><img src=\"/static/e2cbe77e59cc2c1efeae851dbbe165b7/14be6/15.png\" srcset=\"/static/e2cbe77e59cc2c1efeae851dbbe165b7/4cce7/15.png 200w,\n/static/e2cbe77e59cc2c1efeae851dbbe165b7/bae5f/15.png 400w,\n/static/e2cbe77e59cc2c1efeae851dbbe165b7/14be6/15.png 800w,\n/static/e2cbe77e59cc2c1efeae851dbbe165b7/1b35a/15.png 1200w,\n/static/e2cbe77e59cc2c1efeae851dbbe165b7/9ee03/15.png 1600w,\n/static/e2cbe77e59cc2c1efeae851dbbe165b7/a39b6/15.png 1686w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Sivulla on monessa paikassa määriteltyjä tyylejä, osa määrittelyistä tulee Drupal-sisällönhallintajärjestelmän oletuskonfiguraatiosta, osa on Drupaliin laitoksella tehtyjä lisäyksiä, osa taas tulee sivun yläosan olemassaolevaa opetustarjontaa näyttävistä syksyllä lisätyistä komponenteista. Vika on niin hankala korjata, ettei kukaan ole viitsinyt sitä tehdä.</p>\n<p>Demonstroidaan vastaavankaltaista ongelmatilannetta esimerkkisovelluksessamme.</p>\n<p>Muutetaan esimerkkitiedostoamme siten, että komponentista <em>App</em> irrotetaan osa toiminnallisuudesta komponentteihin <em>Hello</em> ja <em>NoteCount</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import &#39;./Hello.css&#39;\n\nconst Hello = ({ counter }) =&gt; (\n  &lt;p className=&quot;content&quot;&gt;\n    hello webpack {counter} clicks!\n  &lt;/p&gt;\n)\n\nexport default Hello</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import &#39;./NoteCount.css&#39;\n\nconst NoteCount = ({ noteCount }) =&gt; (\n  &lt;p className=&quot;content&quot;&gt;\n    {noteCount} notes in server\n  &lt;/p&gt;\n)\n\nexport default NoteCount</code></pre></div>\n<p>Molemmat komponentit määrittelevät oman tyylitiedostonsa:</p>\n<p><em>Hello.css</em></p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">.content {\n  background-color: yellow;\n}</code></pre></div>\n<p><em>NoteCount.css</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">.content {\n  background-color: blue;\n}</code></pre></div>\n<p>Koska molemmat komponentit käyttävät samaa CSS-luokan nimeä <em>content</em>, käykin niin että myöhemmin määritelty ylikirjoittaa aiemmin määritellyn, ja molempien tyyli on sama:</p>\n<picture><img src=\"/static/9e4ef31c953b3a4d43fae58883bceceb/14be6/16.png\" srcset=\"/static/9e4ef31c953b3a4d43fae58883bceceb/4cce7/16.png 200w,\n/static/9e4ef31c953b3a4d43fae58883bceceb/bae5f/16.png 400w,\n/static/9e4ef31c953b3a4d43fae58883bceceb/14be6/16.png 800w,\n/static/9e4ef31c953b3a4d43fae58883bceceb/1b35a/16.png 1200w,\n/static/9e4ef31c953b3a4d43fae58883bceceb/9f651/16.png 1372w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Perinteinen tapa kiertää ongelma on ollut käyttää monimutkaisempia CSS-luokan nimiä, esim. <em>Hello</em>container_ ja <em>NoteCount</em>container_, tämä muuttuu kuitenkin jossain vaiheessa varsin hankalaksi.</p>\n<p><a href=\"https://github.com/css-modules/css-modules\">CSS-moduulit</a> tarjoaa tähän erään ratkaisun.</p>\n<p>Lyhyesti ilmaisten periaatteena on tehdä CSS-määrittelyistä lähtökohtaisesti lokaaleja, vain yhden komponentin kontekstissa voimassa olevia, joka taas mahdollistaa luontevien CSS-luokkanimien käytön. Käytännössä tämä lokaalius toteutetaan generoimalla konepellin alla CSS-luokille uniikit luokkanimet.</p>\n<p>CSS-moduulit voidaan toteuttaa suoraan Webpackin css-loaderin avulla seuraten <a href=\"https://www.triplet.fi/blog/practical-guide-to-react-and-css-modules/\">sivun</a> ohjetta.</p>\n<p>Muutetaan tyylejä käyttäviä komponentteja hiukan:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import styles from &#39;./Hello.css&#39;\n\nconst Hello = ({ counter }) =&gt; (\n  &lt;p className={styles.content}&gt;\n    hello webpack {counter} clicks!\n  &lt;/p&gt;\n)\n\nexport default Hello</code></pre></div>\n<p>Erona siis edelliseen on se, että tyyliit \"sijoitetaan muuttujaan\" <em>styles</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'./Hello.css'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nyt tyylitiedoston määrittelelyihin voi viitata muuttujan <em>styles</em> kautta, ja CSS-luokan liittäminen tapahtuu seuraavasti</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">&lt;p className={styles.content}&gt;</code></pre></div>\n<p>Vastaava muutos tehdään komponentille <em>NoteCount</em>.</p>\n<p>Muutetaan sitten Webpackin konfiguraatiossa olevaa <em>css-loaderin</em> määrittelyä siten että se enabloi <a href=\"https://github.com/webpack-contrib/css-loader#modules\">CSS-modulit</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.css$/</span><span class=\"token punctuation\">,</span>\n  loaders<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'css-loader?modules&amp;importLoaders=1&amp;localIdentName=[name]__[local]___[hash:base64:5]&amp;sourceMap&amp;-minimize'</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nyt molemmat komponentit saavat omat tyylinsä. Konsolista tarkastelemalla huomaamme, että komponenttien luokille on generoitunut webpackin css-loaderin generoimat uniikit nimet:</p>\n<picture><img src=\"/static/a787850c36ef5bbf8ad66ad9cfd5d692/14be6/17.png\" srcset=\"/static/a787850c36ef5bbf8ad66ad9cfd5d692/4cce7/17.png 200w,\n/static/a787850c36ef5bbf8ad66ad9cfd5d692/bae5f/17.png 400w,\n/static/a787850c36ef5bbf8ad66ad9cfd5d692/14be6/17.png 800w,\n/static/a787850c36ef5bbf8ad66ad9cfd5d692/1b35a/17.png 1200w,\n/static/a787850c36ef5bbf8ad66ad9cfd5d692/e5b6a/17.png 1556w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>CSS-luokan nimen muotoileva osa on <em>css-loaderin</em> yhteydessä oleva</p>\n<pre>\nlocalIdentName=[name]\\_\\_[local]\\_\\_\\_[hash:base64:5]\n</pre>\n<p>Jos olet aikeissa käyttää CSS-moduuleja, kannattaa vilkaista mitä kirjasto <a href=\"https://github.com/gajus/react-css-modules\">react-css-modules</a> tarjoaa.</p>\n<h3>Styled components</h3>\n<p>Mielenkiintoisen näkökulman tyylien määrittelyyn tarjoaa ES6:n <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals\">tagged template literal</a> -syntaksia hyödyntävä <a href=\"https://www.styled-components.com/\">styled components</a> -kirjasto.</p>\n<p>Tehdään styled-componentsin avulla esimerkkisovellukseemme muutama tyylillinen muutos:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">import</span> styled from <span class=\"token string\">'styled-components'</span>\n\nconst Button <span class=\"token operator\">=</span> styled.button <span class=\"token variable\"><span class=\"token variable\">`</span>\n  font-size: 1em<span class=\"token punctuation\">;</span>\n  margin: 1em<span class=\"token punctuation\">;</span>\n  padding: 0.25em 1em<span class=\"token punctuation\">;</span>\n  border: 2px solid black<span class=\"token punctuation\">;</span>\n  border-radius: 3px<span class=\"token punctuation\">;</span>\n<span class=\"token variable\">`</span></span>\n\nconst Hello <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> className, counter <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    hello webpack <span class=\"token punctuation\">{</span>counter<span class=\"token punctuation\">}</span> clicks\n  <span class=\"token operator\">&lt;</span>/p<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\nconst StyledHello <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">(</span>Hello<span class=\"token punctuation\">)</span> <span class=\"token variable\"><span class=\"token variable\">`</span>\n  color: blue<span class=\"token punctuation\">;</span>\n  font-weight: bold<span class=\"token punctuation\">;</span>\n<span class=\"token variable\">`</span></span>\n\nclass App extends React.Component <span class=\"token punctuation\">{</span>\n  //<span class=\"token punctuation\">..</span>.\n\n  render<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>StyledHello counter<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>this.state.counter<span class=\"token punctuation\">}</span> /<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>this.onClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>click<span class=\"token operator\">&lt;</span>/Button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>/div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Heti alussa luodaan HTML:n <em>button</em>-elementistä jalostettu versio ja sijoitetaan se muuttujaan <em>Button</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Button <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>button<span class=\"token template-string\"><span class=\"token string\">`\n  font-size: 1em;\n  margin: 1em;\n  padding: 0.25em 1em;\n  border: 2px solid black;\n  border-radius: 3px;\n`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Tyylien määrittelyn syntaksi on varsin mielenkiintoinen.</p>\n<p>Määritelty komponentti toimii kuten normaali <em>button</em> ja sovellus renderöi sen normaaliin tapaan:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{this.onClick}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>click<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Seuraavaksi koodi määrittelee normaalin React-komponentin</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const Hello = ({ className, counter }) =&gt; (\n  &lt;p className={className}&gt;\n    hello webpack {counter} clicks\n  &lt;/p&gt;\n)</code></pre></div>\n<p>ja lisää tälle tyylit metodin <em>styled</em> avulla:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> StyledHello <span class=\"token operator\">=</span> <span class=\"token function\">styled</span><span class=\"token punctuation\">(</span>Hello<span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token string\">`\n  color: blue;\n  font-weight: bold;\n`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Muuttujaan <em>StyledHello</em> sijoitettua tyyleillä jalostettua komponenttia käytetään kuten alkuperäistä:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token operator\">&lt;</span>StyledHello counter<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>this.state.counter<span class=\"token punctuation\">}</span> /<span class=\"token operator\">></span></code></pre></div>\n<p>Sovelluksen ulkoasu seuraavassa:</p>\n<picture><img src=\"/static/2f5e6124b718418ef2afd246b9fc13fe/14be6/18.png\" srcset=\"/static/2f5e6124b718418ef2afd246b9fc13fe/4cce7/18.png 200w,\n/static/2f5e6124b718418ef2afd246b9fc13fe/bae5f/18.png 400w,\n/static/2f5e6124b718418ef2afd246b9fc13fe/14be6/18.png 800w,\n/static/2f5e6124b718418ef2afd246b9fc13fe/1b35a/18.png 1200w,\n/static/2f5e6124b718418ef2afd246b9fc13fe/7f7ac/18.png 1542w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<h2>Sovelluksen end to end -testaus</h2>\n<p>Palataan vielä hetkeksi testauksen pariin. Aiemmissa osissa teimme sovelluksille yksikkötestejä sekä integraatiotestejä. Katsotaan nyt erästä tapaa tehdä <a href=\"https://en.wikipedia.org/wiki/System_testing\">järjestelmää kokonaisuutena</a> tutkivia <em>End to End (E2E) -testejä</em>.</p>\n<p>Web-sovellusten E2E-testaus tapahtuu simuloidun selaimen avulla esimerkiksi <a href=\"http://www.seleniumhq.org/\">Selenium</a>-kirjastoa käyttäen. Toinen vaihtoehto on käyttää ns. <a href=\"https://en.wikipedia.org/wiki/Headless_browser\">headless browseria</a> eli selainta, jolla ei ole ollenkaan graafista käyttöliittymää.</p>\n<p>Chrome-selain on jo hetken sisältänyt <a href=\"https://developers.google.com/web/updates/2017/04/headless-chrome\">headless</a>-moodin. Käytetään nyt headless chromea sille Node API:n tarjoavan <a href=\"https://github.com/GoogleChrome/puppeteer\">Puppeteer</a>-kirjaston avulla.</p>\n<p>Tehdään muutama testi osan 3 muistiinpanosovelluksen <a href=\"/osa3#sovellus-internettiin\">\"Full stack\"-versiolle</a>, joka sisältää sekä backendin että frontin samassa projektissa.</p>\n<p>Asennetan puppeteer komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> puppeteer --save-dev</code></pre></div>\n<p>Ennen testejä, tehdään kokeiluja varten tiedosto <em>puppeteer.js</em> ja sille seuraava sisältö</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> puppeteer <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">screenshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'kuva.png'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Kun koodi suoritetaan komennolla <em>node puppeteer.js</em> menee <em>headless chrome</em> osoitteeseen <a href=\"http://localhost:3000\">http://localhost:3000</a> ja tallettaa sivulta ottamansa screenshotin tiedostoon <em>kuva.png</em>:</p>\n<picture><img src=\"/static/7347cd9c9c28cc9fcb0a6d2cf93a7891/14be6/19.png\" srcset=\"/static/7347cd9c9c28cc9fcb0a6d2cf93a7891/4cce7/19.png 200w,\n/static/7347cd9c9c28cc9fcb0a6d2cf93a7891/bae5f/19.png 400w,\n/static/7347cd9c9c28cc9fcb0a6d2cf93a7891/14be6/19.png 800w,\n/static/7347cd9c9c28cc9fcb0a6d2cf93a7891/1b35a/19.png 1200w,\n/static/7347cd9c9c28cc9fcb0a6d2cf93a7891/e8390/19.png 1492w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Muutetaan koodia vielä siten, että se kirjottaa sivulla olevaan <em>input</em>-elementtiin</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Headless Chrome'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">screenshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'kuva.png'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Screenshot todistaa että näin on todellakin tapahtunut:</p>\n<picture><img src=\"/static/71a3a9163142d907a04c9b56cb36e6a8/14be6/20.png\" srcset=\"/static/71a3a9163142d907a04c9b56cb36e6a8/4cce7/20.png 200w,\n/static/71a3a9163142d907a04c9b56cb36e6a8/bae5f/20.png 400w,\n/static/71a3a9163142d907a04c9b56cb36e6a8/14be6/20.png 800w,\n/static/71a3a9163142d907a04c9b56cb36e6a8/1b35a/20.png 1200w,\n/static/71a3a9163142d907a04c9b56cb36e6a8/97a7b/20.png 1502w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Debugatessa voi olla joskus avuksi myös käynnistää selain normaalimoodissa, ja hidastaa testien suoritusta:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    headless<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    slowMo<span class=\"token punctuation\">:</span> <span class=\"token number\">250</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// jokainen operaatio kestää nyt 0.25 sekuntia</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Tehdään sitten muutama testi. Toimiakseen hyvin Jestin kanssa vaaditaan hieman konfiguraatiota, joka onnistuu Jestin dokumentaation <a href=\"https://facebook.github.io/jest/docs/en/puppeteer.html#content\">ohjetta</a> noudattaen.</p>\n<p>Tehdään ensimmäinen testi</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'note app'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders main page'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> global<span class=\"token punctuation\">.</span>__BROWSER__<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> textContent <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">,</span> el <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>textContent<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Muistiinpanot'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Konfiguraatioiden ansiosta viite selaimeen on muuttujassa <code>global.<strong>BROWSER</strong></code></p>\n<p>Selaimelta pyydetään aluksi <a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#class-page\">page</a>-olio, ja sen metodilla <a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pageevalselector-pagefunction-args-1\">$eval</a> haetaan sivun elementissä <em>body</em> oleva tekstuaalinen sisältö.</p>\n<p>Tehdään toinen testi, refaktoroidaan samalla testin yhteinen koodi <a href=\"https://facebook.github.io/jest/docs/en/setup-teardown.html\">beforeEach</a>-metodiin:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'note app'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> page<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> global<span class=\"token punctuation\">.</span>__BROWSER__<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders main page'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> textContent <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">,</span> el <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>textContent<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Muistiinpanot'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders a note'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> textContent <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">,</span> el <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>textContent<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HTML on helppoa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Testi ei yllättäen mene läpi. Jos testissä tulostetaan konsoliin olion page metodilla <a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagecontent\">content</a> palauttama sivun koko sisältö, huomataan että sivulla ei todellakaan ole yhtään muistiinpanoa:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>noscript</span><span class=\"token punctuation\">></span></span>\n    You need to enable JavaScript to run this app.\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>noscript</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Muistiinpanot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span>näytä vain tärkeät<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>notes<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span>tallenna<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/main.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Syynä tälle on se, että puppeteer on ollut liian nopea, ja sivu ei ole <em>ehtinyt</em> renderöityä.</p>\n<p>Koska muistiinpanot sisältävällä <em>div</em>-elementillä on CSS-luokka <em>wrapper</em>, testi saadaan menemään läpi <em>odottamalla</em> koko kyseisten elementtien renderöitymistä metodin <a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagewaitforselectorselector-options\">waitForSelector</a> avulla:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders a note'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.wrapper'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> textContent <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">,</span> el <span class=\"token operator\">=></span> el<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>textContent<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HTML on helppoa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Muutetaan testi hieman parempaan muotoon</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders a note'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.wrapper'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> notes <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> elements <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.wrapper'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> elements<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HTML on helppoa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Jestin <a href=\"https://github.com/GoogleChrome/puppeteer/issues/303\">issueista</a> löydetyn neuvon avulla testi hakee sivun kaikkien muistiinpanojen sisällöt ja tekee ekspektaatiot niiden avulla.</p>\n<p>Lopuksi tehdään testi, joka luo uuden muistiinpanon</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'allows new notes to be added'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> note <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`jestin lisäämä muistiinpano </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> note<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token string\">'form button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.notification'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ilman tätä testi ei mene läpi</span>\n\n  <span class=\"token keyword\">const</span> notes <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> elements <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.wrapper'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> elements<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>note<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lomakkeen täyttäminen on helppoa. Koska sivulla on useita painikkeita, on käytetty CSS-selektoria <em>form button</em> joka hakee sivulta lomakkeen sisällä olevan napin.</p>\n<p>Napin painalluksen jälkeen syntyy jälleen potentiaalinen ajoitusongelma jos uuden muistiinpanon sivulle renderöitymistä testataan liian nopeasti. Ongelma on kierretty sillä, että sovellusta on muutettu siten, että se näyttää ruudulla CSS-luokalla <em>notification</em> merkityssä <em>div</em>-elementissä uuden muistiinpanon lisäämisestä kertovan ilmoituksen.</p>\n<p>Testausasetelmamme kaipaisi vielä paljon hiomista. Testejä vartan olisi mm. oltava oma tietokanta, jonka tilan testien pitäisi pystyä nollaamaan hallitusti. Nyt testit luottavat siihen että sovellus on käynnissä portissa 3001. Olisi parempi jos testit itse käynnistäisivät ja sammuttaisivat palvelimen.</p>\n<p>Lisää aiheesta <a href=\"https://github.com/GoogleChrome/puppeteer\">Puppeteerin Github-sivujen</a> lisäksi esimerkiksi seuraavassa <a href=\"https://www.valentinog.com/blog/ui-testing-jest-puppetteer/\">https://www.valentinog.com/blog/ui-testing-jest-puppetteer/</a></p>\n<h2>Tyypitys</h2>\n<p>Javascriptin muuttujien <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Dynamic_typing\">dynaaminen tyypitys</a> aiheuttaa välillä ikäviä bugeja. Osassa 5 käsittelimme lyhyesti <a href=\"/osa5/#proptypes\">PropTypejä</a>, eli mekanismia, jonka avulla React-komponenteille välitettävile propseille on mahdollista tehdä tyyppitarkastuksia.</p>\n<p>Viime aikoina on ollut havaittavissa nousevaa kiinnostusta <a href=\"https://en.wikipedia.org/wiki/Type_system#Static_type_checking\">staattiseen tyypitykseen</a>.</p>\n<p>Javascriptistä on olemassa useita staattisesti tyypitettyjä versioita, suosituimmat näistä ovat Facebookin kehittämä <a href=\"https://flow.org/\">flow</a> ja Microsofin <a href=\"https://www.typescriptlang.org/\">typescript</a>.</p>\n<p>Flown käyttöönottaminen create-react-app:illa toteutettuun sovellukseen on <a href=\"https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#adding-flow\">helppoa</a>. Tiedostossa <em>.flowconfig</em> kannattaa ignoroida hakemistoissa <em>node</em>modules_ ja <em>dist</em> olevat tiedostot</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>ignore<span class=\"token punctuation\">]</span>\n.*/node_modules/.*\n.*/dist/.*</code></pre></div>\n<p>Flow tarkastaa ainoastaan ne tiedostot, joiden alussa on kommentissa oleva merkintä <em>@flow</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// @flow</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">:</span> number<span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">:</span> number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> number <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> n <span class=\"token operator\">+</span> m<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Tyyppitarkastus tapahtuu komennolla <em>npm run flow</em>. Flow huomauttaa virheestä:</p>\n<picture><img src=\"/static/528fe8fb8f9eeec6fe38aa339a1ac016/14be6/21.png\" srcset=\"/static/528fe8fb8f9eeec6fe38aa339a1ac016/4cce7/21.png 200w,\n/static/528fe8fb8f9eeec6fe38aa339a1ac016/bae5f/21.png 400w,\n/static/528fe8fb8f9eeec6fe38aa339a1ac016/14be6/21.png 800w,\n/static/528fe8fb8f9eeec6fe38aa339a1ac016/af150/21.png 1122w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Koodi kuitenkin yllättäen toimii, jos koodiin lisätään konsoliin tehtävä tulostus</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> summa <span class=\"token operator\">=</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>summa<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>tulostuu luku 12.</p>\n<p>Flow suorittaa koodille ainoastaan tyyppitarkastuksen, <a href=\"https://babeljs.io/docs/plugins/preset-flow/\">babel</a> kääntää flow-tyyppejä sisältävän koodin normaaliksi Javascriptiksi ja tyyppien tarjoma suoja onkin voimassa ainoastaan jos ohjelmoija suorittaa tyyppitarkastuksia.</p>\n<p>Kaikissa tapauksissa tyyppejä ei edes ole tarvetta määritellä, joissain tapauksissa flow osaa päätellä itse mikä muuttujien tyypin tulee olla. Esim. seuraavassa tapauksessa</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">square</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> n <span class=\"token operator\">*</span> n<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">square</span><span class=\"token punctuation\">(</span><span class=\"token string\">'5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>flow osaa varoittaa ongelmasta ilman tyyppien määrittelyä</p>\n<picture><img src=\"/static/d64856106c05b608aab4945b64d2c7f1/14be6/22.png\" srcset=\"/static/d64856106c05b608aab4945b64d2c7f1/4cce7/22.png 200w,\n/static/d64856106c05b608aab4945b64d2c7f1/bae5f/22.png 400w,\n/static/d64856106c05b608aab4945b64d2c7f1/14be6/22.png 800w,\n/static/d64856106c05b608aab4945b64d2c7f1/ee81e/22.png 1134w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Flown hyvä puoli on keveys, vanhoihinkin projekteihin on helppo ruveta vähitellen lisäämään tyyppejä Flowlla.</p>\n<p>Typescript on jossain määrin laajempi ratkaisu ja sen käyttö vaatii Flowia enemmän konfigurointia. Typescript-koodi kirjoitetaan <em>.ts</em>-päätteisiin tiedostoihin ja se tulee kääntää Javascriptiksi. Käännös pystytään toki hoitamaan helposti <a href=\"https://github.com/s-panferov/awesome-typescript-loader\">webpackilla</a>. Toisin kun flown yhteydessä, Typescriptillä tehdyssä koodissa oleva virheellinen tyyppien käyttö johtaa siihen, että koodi ei käänny.</p>\n<p>Internetistä löytyy runsaasti Flowta ja Typescriptiä vertailevia artikkeleja, ks esim.:</p>\n<ul>\n<li><a href=\"https://blog.mariusschulz.com/2017/01/13/typescript-vs-flow\">https://blog.mariusschulz.com/2017/01/13/typescript-vs-flow</a></li>\n<li><a href=\"https://michalzalecki.com/typescript-vs-flow/\">https://michalzalecki.com/typescript-vs-flow/</a></li>\n<li><a href=\"https://github.com/niieani/typescript-vs-flowtype\">https://github.com/niieani/typescript-vs-flowtype</a></li>\n</ul>\n<h2>Muutamia huomioita liittyen Reactiin, Reduxiin ja Nodeen</h2>\n<h3>React-sovelluksen koodin organisointi</h3>\n<p>Noudatimme useimmissa sovelluksissa periaatetta, missä komponentit sijoitettiin hakemistoon <em>components</em>, reducerit hakemistoon <em>reducers</em> ja palvelimen kanssa kommunikoiva koodi hakemistoon <em>services</em>. Tälläinen organisoimistapa riittää pienehköihin sovelluksiin, mutta komponenttien määrän kasvaessa tarvitaan muunlaisia ratkaisuja. Yhtä oikeaa tapaa ei ole, artikkeli <a href=\"https://hackernoon.com/the-100-correct-way-to-structure-a-react-app-or-why-theres-no-such-thing-3ede534ef1ed\">The 100% correct way to structure a React app (or why there’s no such thing)</a>\ntarjoaa näkökulmia aiheeseen.</p>\n<h3>Frontti ja backend samassa repositoriossa</h3>\n<p>Olemme kurssilla tehneet frontendin ja backendin omiin repositorioihinsa. Kyseessä on varsin tyypillinen ratkaisu. Teimme tosin deploymentin <a href=\"/osa3#staattisten-tiedostojen-tarjoaminen-backendist%C3%A4\">kopioimalla</a> frontin bundlatun koodin backendin repositorion sisälle. Toinen, ehkä järkevämpi tilanne olisi ollut deployata frontin koodi erikseen, create-react-appilla tehtyjen sovellusten osalta se on todella helppoa oman <a href=\"https://github.com/mars/create-react-app-buildpack\">buildpackin</a> ansiosta.</p>\n<p>Joskus voi kuitenkin olla tilanteita, missä koko sovellus halutaan samaan repositorioon. Tällöin yleinen ratkaisu on sijoittaa <em>package.json</em> ja <em>webpack.config.js</em> hakemiston juureen ja frontin sekä backendin koodi omiin hakemistoihinsa, esim. <em>client</em> ja <em>server</em>.</p>\n<p>Erään hyvän lähtökohdan yksirepositorioisen koodin organisoinnille antaa <a href=\"http://mern.io/\">MERN</a>-projektin ylläpitämä <a href=\"https://github.com/Hashnode/mern-starter\">MERN starter</a>.</p>\n<h3>Palvelimella tapahtuvat muutokset</h3>\n<p>Jos palvelimella olevassa tilassa tapahtuu muutoksia, esim. blogilistapalveluun lisätään uusia blogeja muiden käyttäjien toimesta, tällä kurssilla tekemämme React-frontendit eivät huomaa muutoksia ennen sivujen uudelleenlatausta. Vastaava tilanne tulee eteen, jos frontendistä käynnistetään jotain kauemmin kestävää laskentaa backendiin, miten laskennan tulokset saadaan heijastettua frontediin?</p>\n<p>Eräs tapa on suorittaa frontendissa <a href=\"https://en.wikipedia.org/wiki/Polling_(computer_science)\">pollausta</a>, eli toistuvia kyselyitä backendin APIin esim. <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval</a>-komennon avulla.</p>\n<p>Edistyneempi tapa on käyttää <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\">WebSocketeja</a>, joiden avulla on mahdollista muodostaa kaksisuuntainen kommunikaatiokanava selaimen ja palvelimen välille. Tällöin frontendin ei tarvitse pollata backendia, riittää määritellä takaisinkutsufunktiot tilanteisiin, joissa palvelin lähettää WebSocketin avulla tietoja tilan päivittämisestä.</p>\n<p>WebSocketit ovat selaimen tarjoama rajapinta, jolla ei kuitenkaan ole kaikille selaimille vielä täyttä tukea:</p>\n<picture><img src=\"/static/91a365e07d432695f4c8213f41f2dadf/14be6/22a.png\" srcset=\"/static/91a365e07d432695f4c8213f41f2dadf/4cce7/22a.png 200w,\n/static/91a365e07d432695f4c8213f41f2dadf/bae5f/22a.png 400w,\n/static/91a365e07d432695f4c8213f41f2dadf/14be6/22a.png 800w,\n/static/91a365e07d432695f4c8213f41f2dadf/1b35a/22a.png 1200w,\n/static/91a365e07d432695f4c8213f41f2dadf/78a53/22a.png 1564w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>WebSocket API:n suoran käyttämisen sijaan onkin suositeltavaa käyttää <a href=\"https://socket.io/\">Socket.io</a>-kirjastoa, joka tarjoaa erilaisia automaattisia <em>fallback</em>-mahdollisuuksia, jos käytettävässä selaimessa ei ole täyttä WebSocket-tukea.</p>\n<h3>Virtual DOM</h3>\n<p>Reactin yhteydessä mainitaan usein käsite Virtual DOM. Mistä oikein on kyse? Kuten <a href=\"/osa0#document-object-model-eli-dom\">osassa 0</a> mainittiin, selaimet tarjoavat <a href=\"https://developer.mozilla.org/fi/docs/DOM\">DOM API</a>:n, jota hyväksikäyttäen selaimessa toimiva Javascript voi muokata sivun ulkoasun määritteleviä elementtejä.</p>\n<p>Reactia käyttäessä ohjelmoija ei koskaan (tai parempi sanoa yleensä) manipuloi DOM:ia suoraan. React-komponenttien ulkoasun määrittelevä <em>render</em>-metodi palauttaa joukon <a href=\"https://reactjs.org/docs/glossary.html#elements\">React-elementtejä</a>. Vaikka osa elementeistä näyttää normaaleilta HTML-elementeiltä</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const element = &lt;h1&gt;Hello, world&lt;/h1&gt;</code></pre></div>\n<p>eivät nekään ole HTML:ää vaan pohjimmiltaan Javascriptiä olevia React-elementtejä.</p>\n<p>Sovelluksen komponenttien ulkoasun määrittelevät React-elementit muodostavat <a href=\"https://reactjs.org/docs/faq-internals.html#what-is-the-virtual-dom\">Virtual DOM:in</a>, joka pidetään suorituksen aikana keskusmuistissa.</p>\n<p><a href=\"https://reactjs.org/docs/react-dom.html\">ReactDOM</a>-kirjaston avulla komponenttien määrittelevä virtuaalinen DOM renderöidään oikeaksi DOM:iksi eli DOM API:n avulla selaimen näytettäväksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">ReactDOM.render(\n  &lt;App /&gt;,\n  document.getElementById(&#39;root&#39;)\n)</code></pre></div>\n<p>Kun sovelluksen tila muuttuu, määrittyy komponenttien render-metodien ansiosta <em>uusi virtuaalinen DOM</em>. Reactilla on edellinen versio virtual DOM:ista muistissa ja sensijaan että uusi virtuaalinen DOM renderöitäisiin suoraviivaisesti DOM API:n avulla, React laskee mikä on optimaalisin tapa tehdä DOM:iin muutoksia (eli poistaa, lisätä ja muokata DOM:issa olevia elementtejä) siten, että DOM saadaan vastaamaan uutta Virtual DOM:ia.</p>\n<h3>Reactin roolista sovelluksissa</h3>\n<p>Materiaalissa ei ole tuotu ehkä riittävän selkeästi esille sitä, että React on ensisijaisesti tarkoitettu näkymien luomisesta huolehtivaksi kirjastoksi. Jos ajatellaan perinteistä <a href=\"https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller\">Model View Controller</a> -jaottelua, on Reactin toimialaa juurikin <em>View</em>. React on siis sovellusalueeltaan suppeampi kuin esim. <a href=\"https://angular.io/\">Angular</a>, joka on kaiken tarjoava Frontendin MVC-sovelluskehys. Reactia ei kutsutakaan sovelluskehykseksi (framework) vaan kirjastoksi (library).</p>\n<p>Pienissä sovelluksissa React-komponenttien tilaan talletetaan sovelluksen käsittelemää dataa, eli komponenttien tilan voi näissä tapaukissa ajatella vastaavan MVC:n modeleita.</p>\n<p>React-sovellusten yheydessä ei kuitenkaan yleensä puhuta MVC-arkkitehtuurista ja jos käytössä on Redux niin silloin sovellukset noudattavat <a href=\"https://facebook.github.io/flux/docs/in-depth-overview.html#content\">Flux</a>-arkkitehtuuria ja Reactin rooliksi jää entistä enemmän pelkkä näkymien muodostaminen. Varsinainen sovelluslogiikka hallitaan Reduxin tilan ja action creatorien avulla. Jos käytössä on osasta 6 tuttu <a href=\"/osa6#asynkroniset-actionit-ja-redux-thunk\">redux thunk</a>, on sovelluslogiikka mahdollista eristää lähes täysin React-koodista.</p>\n<p>Koska sekä React että <a href=\"https://facebook.github.io/flux/docs/in-depth-overview.html#content\">Flux</a> ovat Facebookilla syntyneinä, voi ajatella, että Reactin pitäminen ainoastaan käyttöliittymästä huolehtivana kirjastona on sen oikeaoppista käyttöä. Flux-arkkitehtuurin noudattaminen tuo sovelluksiin tietyn overheadin ja jos on kyse pienestä sovelluksesta tai prototyypistä, saattaa Reatcin \"väärinkäyttäminen\" olla järkevää, sillä myöskään <a href=\"https://en.wikipedia.org/wiki/Overengineering\">overengineering</a> ei yleensä johda optimaaliseen tulokseen.</p>\n<h2>React/node-sovellusten tietoturva</h2>\n<p>Emme ole vielä maininneet kurssilla sanaakaan tietoturvaan liittyen. Kovin paljoon ei nytkään ole aikaa, ja onneksi laitoksella on MOOC-kurssi <a href=\"https://cybersecuritybase.github.io/securing/\">Securing Software</a> tähän tärkeään aihepiiriin.</p>\n<p>Katsotaan kuitenkin muutamaa kurssispesifistä seikkaa.</p>\n<p>The Open Web Application Security Project eli <a href=\"https://www.owasp.org\">OWASP</a> julkaisee vuosittain listan Websovellusten yleisimmistä turvallisuusuhista. Tuorein lista on <a href=\"https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf\">täällä</a>. Samat uhat ovat listalla vuodesta toiseen.</p>\n<p>Listaykkösenä on <em>injection</em>, joka tarkoittaa sitä, että sovellukseen esim. lomakkeen avulla lähetettävä teksti tulkitaankin aivan eri tavalla kun sovelluskehittäjä on tarkoittanut. Kuuluisin injektioiden muoto lienevät <a href=\"https://stackoverflow.com/questions/332365/how-does-the-sql-injection-from-the-bobby-tables-xkcd-comic-work\">SQL-injektiot</a>.</p>\n<p>Esim. jos ei-turvallisessa koodissa tehtäisiin seuraavasti muotoiltu SQL-kysely:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token string\">\"SELECT * FROM Users WHERE name = '\"</span> <span class=\"token operator\">+</span> userName <span class=\"token operator\">+</span> <span class=\"token string\">\"';\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Oletetaan että hieman ilkeämielinen käyttäjä <em>Arto Hellas</em> nyt määrittelisi nimekseen</p>\n<pre>\nArto Hell-as'; DROP TABLE Users; --\n</pre>\n<p>eli nimi sisältäisi hipsun <code>'</code>, jonka on SQL:ssä merkkijonon aloitus/lopetusmerkki. Tämän seurauksena tulisi suoritetuksi kaksi SQL-operaatiota, joista jälkimmäinen tuhoaisi tietokannan</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> Users <span class=\"token keyword\">WHERE</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Arto Hell-as'</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> Users<span class=\"token punctuation\">;</span> <span class=\"token comment\">--'</span></code></pre></div>\n<p>SQL-injektiot estetään <a href=\"https://security.stackexchange.com/questions/172297/sanitizing-input-for-parameterized-queries\">sanitoimalla</a> syöte, eli tarkastamalla, että kyselyjen parametrit eivät sisällä kiellettyjä merkkejä, kuten tässä tapauksessa hipsun. Jos kiellettyjä merkkejä löytyy, ne korvataan turvallisilla vastineilla <a href=\"https://en.wikipedia.org/wiki/Escape_character#JavaScript\">escapettamalla</a>.</p>\n<p>Myös NoSQL-kantoihin tehtävät injektiohyökkäykset ovat mahdollisia. Mongoose kuitenkin estää ne <a href=\"https://zanon.io/posts/nosql-injection-in-mongodb\">sanitoimalla</a> kyselyt. Lisää aiheesta esim. <a href=\"https://blog.websecurify.com/2014/08/hacking-nodejs-and-mongodb.html\">täällä</a>.</p>\n<p><em>Cross-site scripting eli XSS</em> on hyökkäys, missä sovellukseen on mahdollista injektoida suoritettavaksi vihollismielistä Javascript-koodia. Jos kokeilemme injektoida esim. muistiinpanosovellukseen seuraavan</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\">\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Evil XSS attack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>koodia ei suoriteta, vaan koodi renderöityy sivulle 'tekstinä':</p>\n<picture><img src=\"/static/3bdeeec6c8c75fd68d5005529a576f61/14be6/23.png\" srcset=\"/static/3bdeeec6c8c75fd68d5005529a576f61/4cce7/23.png 200w,\n/static/3bdeeec6c8c75fd68d5005529a576f61/bae5f/23.png 400w,\n/static/3bdeeec6c8c75fd68d5005529a576f61/14be6/23.png 800w,\n/static/3bdeeec6c8c75fd68d5005529a576f61/7493e/23.png 1102w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>sillä React <a href=\"https://reactjs.org/docs/introducing-jsx.html#jsx-prevents-injection-attacks\">huolehtii muuttujissa olevan datan sanitoinnista</a>. Reactin jotkut versiot <a href=\"https://medium.com/dailyjs/exploiting-script-injection-flaws-in-reactjs-883fb1fe36c1\">ovat mahdollistaneet</a> XSS-hyökkäyksiä, aukot on toki korjattu, mutta mikään ei takaa etteikö niitä voisi vielä löytyä.</p>\n<p>Käytettyjen kirjastojen suhteen tuleekin olla tarkkana, jos niihin tulee tietoturvapäivityksiä, on kirjastot syytä päivittää omissa sovelluksissa. Expressin tietoturvapäivitykset löytyvät <a href=\"https://expressjs.com/en/advanced/security-updates.html\">kirjaston dokumentaatiosta</a> ja Nodeen liittyvät <a href=\"https://nodejs.org/en/blog/\">blogista</a>.</p>\n<p>Riippuvuuksien ajantasaisuuden voi testata komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> outdated --depth 0</code></pre></div>\n<picture><img src=\"/static/760bb1a5fa6718dead5c8e6a626da002/14be6/24.png\" srcset=\"/static/760bb1a5fa6718dead5c8e6a626da002/4cce7/24.png 200w,\n/static/760bb1a5fa6718dead5c8e6a626da002/bae5f/24.png 400w,\n/static/760bb1a5fa6718dead5c8e6a626da002/14be6/24.png 800w,\n/static/760bb1a5fa6718dead5c8e6a626da002/62839/24.png 1128w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Riippuvuudet saa ajantasaistettua päivittämällä tiedostoa <em>package.json</em> ja suorittamalla komennon <em>npm install</em>. Riippuvuuksien vanhat versiot eivät tietenkään välttämättä ole tietoturvariski.</p>\n<p>Aiemmissa Noden ja npm:n versioissa <a href=\"https://nodesecurity.io/\">Node Security Platform</a> valvoi npm:ssä olevien riippuvuuksien turvallisuutta; Noden versiosta 10.0.0 ja npm:n versiosta 6.0.0 alkaen Node Security Platform <a href=\"https://medium.com/npm-inc/npm-acquires-lift-security-258e257ef639\">on osa npm:ää</a>, eli riippuvuuksien turvallisuutta voidaan tarkistaa <a href=\"https://docs.npmjs.com/cli/audit\"><em>audit</em>-komennolla</a> (ja npm tarkistaa sitä automaattisesti kun sovellukselle asetetaan uusia pakkauksia).</p>\n<p>Toinen palvelu riippuvuuksien turvallisuuden tarkkailuun on <a href=\"https://snyk.io\">Snyk</a>.</p>\n<p>Eräs OWASP:in listan mainitsemista uhista on <em>Broken Authentication</em> ja siihen liittyvä <em>Broken Access Control</em>. Käyttämämme token-perustainen autentikointi on kohtuullisen robusti, jos sovellusta käytetään tietoliikenteen salaavalla HTTPS-protokollalla. Access Controlin eli pääsynhallinnan toteuttamisessa on aina syytä muistaa tehdä esim. käyttäjän identiteetin tarkastus selaimen lisäksi myös palvelimella. Huonoa tietoturvaa olisi estää jotkut toimenpiteet ainoastaan piilottamalla niiden suoritusmahdollisuus selaimessa olevasta koodista.</p>\n<p>Mozillan MDN:n erittäin hyvä <a href=\"https://developer.mozilla.org/en-US/docs/Learn/Server-side/First_steps/Website_security\">Website security -guide</a> nostaakin esiin tämän tärkeän seikan:</p>\n<picture><img src=\"/static/5ed53c747aaebd35c52fe29f271e2fee/14be6/25a.png\" srcset=\"/static/5ed53c747aaebd35c52fe29f271e2fee/4cce7/25a.png 200w,\n/static/5ed53c747aaebd35c52fe29f271e2fee/bae5f/25a.png 400w,\n/static/5ed53c747aaebd35c52fe29f271e2fee/14be6/25a.png 800w,\n/static/5ed53c747aaebd35c52fe29f271e2fee/1b35a/25a.png 1200w,\n/static/5ed53c747aaebd35c52fe29f271e2fee/0b406/25a.png 1388w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Expressin dokumentaatio sisältää tietoturvaa käsittelevän osan <a href=\"https://expressjs.com/en/advanced/best-practice-security.html\">Production Best Practices: Security</a> joka kannattaa lukea läpi. Erittäin suositeltavaa on ottaa backendissa käyttöön <a href=\"https://helmetjs.github.io/\">Helmet</a>-kirjasto, joka sisältää joukon Express-sovelluksista tunnettuja turvallisuusriskejä eliminoivia middlewareja.</p>\n<p>Myös ESlintin <a href=\"https://github.com/nodesecurity/eslint-plugin-security\">security-plugininen</a> käyttöönotto kannattaa.</p>\n<h2>Tulevaisuuden trendit</h2>\n<p>Katsotaan vielä lopuksi muutamaa huomisen tai oikeastaan jo tämän päivän tekniikkaa, ja suuntia joihin Web-sovelluskehitys on kulkemassa.</p>\n<h3>Server side rendering, isomorfiset sovellukset ja universaali koodi</h3>\n<p>Selain ei ole ainoa paikka missä Reactilla määriteltyjä komponentteja voidaan renderöidä. Renderöinti on mahdollista tehdä myös <a href=\"https://reactjs.org/docs/react-dom-server.html\">palvelimella</a>. Tätä hyödynnetäänkin nykyään enenevissä määrin siten, että kun sovellukseen tullaan ensimmäistä kertaa, lähettää palvelin selaimeen jo valmiiksi renderöimänsä Reactilla muodostetun sivun. Tämän jälkeen sovelluksen toiminta jatkuu normaaliin tapaan, eli selain suorittaa Reactia, joka manipuloi selaimen näyttämää DOM:ia. Palvelimella tapahtuvasta renderöinnistä käytetään englanninkielistä nimitystä <em>server side rendering</em>.</p>\n<p>Eräs motivaatio server side renderingille on Search Engine Optimization eli SEO. Hakukoneet ovat ainakin perinteisesti olleet huonoja tunnistamaan selaimessa Javascriptillä renderöityä sisältöä, ajat saattavat tosin olla muuttumassa, ks. esim. <a href=\"https://www.andrewhfarmer.com/react-seo/\">tämä</a> ja <a href=\"https://medium.freecodecamp.org/seo-vs-react-is-it-neccessary-to-render-react-pages-in-the-backend-74ce5015c0c9\">tämä</a>.</p>\n<p>Server side rendering ei tietenkään ole mikään React- tai edes Javascript-spesifi asia, saman ohjelmointikielen käyttö kaikkialla koodissa tekee konseptista teoriassa helpommin toteutettavan, sillä samaa koodia voidaan suorittaa sekä backendissä että frontendissä.</p>\n<p>Palvelimella tapahtuvaan renderöintiin liittyen on alettu puhua <em>isomorfisista sovelluksista</em> ja <em>universaalista koodista</em>, termien määritelmistä on kiistelty. Joidenkin <a href=\"https://medium.com/@ghengeveld/isomorphism-vs-universal-javascript-4b47fb481beb\">määritelmien</a> mukaan isomorfinen web-sovellus on sellainen, joka suorittaa renderöintiä sekä selaimessa että backendissa. Universaalinen koodi taas on koodia, joka voidaan suorittaa useimmissa ympäristöissä eli sekä selaimessa että backendissä.</p>\n<p>React ja Node tarjoavatkin varteenotettavan vaihtoehdon isomorfisten sovellusten toteuttamiseen universaalina koodina.</p>\n<p>Universaalin koodin kirjoittaminen suoraan Reactin avulla on vielä toistaiseksi melko vaivalloista.\nViime aikoina paljon huomiota saanut Reactin päälle toteutettu <a href=\"https://github.com/zeit/next.js/\">Next.js</a>-kirjasto on hyvä vaihtoehto universaalien sovellusten tekemiseen.</p>\n<h1>Progressive web apps</h1>\n<p>Viime aikona on myös ruvettu käyttämään Googlen lanseeraamaa termiä <a href=\"https://developers.google.com/web/progressive-web-apps/\">progressive web app</a> (PWA). Googlen sivuilla oleva määritelmä kuulostaa markkinapuheelta ja sen perusteella on hankala saada selkeää käsitystä mistä on kyse. <a href=\"https://developers.google.com/web/progressive-web-apps/checklist\">Checklista</a> tuo mukaan konkretiaa.</p>\n<p>Tiiviistäen kyse on web-sovelluksista, jotka toimivat mahdollisimman hyvin kaikilla alustoilla ottaen jokaisesta alustasta irti sen parhaat puolet. Mobiililaitteiden pienempi näyttö ei saa heikentää sovellusten käytettävyyttä. PWA-sovellusten tulee myös toimia offline-tilassa tai hitaalla verkkoyhteydellä moitteettomasti. Mobiililaitteilla ne tulee pystyä asentamaan normaalien sovellusten tavoin. Kaiken PWA-sovellusten käyttämän verkkoliikenteen tulee olla salattua.</p>\n<p>create-react-app:illa luodut sovellukset ovat oletusarvoisesti <a href=\"https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#making-a-progressive-web-app\">progressiivisia</a>. Jos sovellus käyttää palvelimella olevaa dataa, edellyttää sovelluksen progressiiviseksi tekeminen vaivan näkemistä. Offline-toiminnallisuus toteutetaan yleensä <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API\">service workerien</a> avulla.</p>\n<h1>Mikropalveluarkkitehtuuri</h1>\n<p>Tällä kurssilla olemme tehneet palvelinpuolelle ainoastaan matalan pintaraapaisun. Sovelluksissamme on ollut korkeintaan muutaman API-endpointin tarjoava <em>monoliittinen</em> eli yhdellä palvelimella pyörivä kokonaisuuden muodostava backend.</p>\n<p>Sovelluksen kasvaessa suuremmaksi monoliittisen backendin malli alkaa muuttua ongelmalliseksi niin suorituskyvyn kuin jatkokehitettävyydenkin kannalta.</p>\n<p><a href=\"https://martinfowler.com/articles/microservices.html\">Mikropalveluarkkitehtuurilla</a> (microservice) tarkoitetaan tapaa koostaa sovelluksen backend useista erillisistä autonomisista palveluista, jotka kommunikoivat keskenään verkon yli. Yksittäisen mikropalvelun on tarkoituksena hoitaa tietty looginen toiminnallinen kokonaisuus. Puhdasoppisessa mikropalveluarkkitehtuurissa palvelut eivät käytä jaettua tietokantaa.</p>\n<p>Esim. blogilistasovelluksen voisi koostaa kahdesta palvelusta, toinen huolehtisi käyttäjistä ja toinen blogeista. Käyttäjäpalvelun vastuulla olisi käyttäjätunnusten luominen ja käyttäjien autentikointi, blogipalvelu taas huolehtisi blogeihin liittyvistä toimista.</p>\n<p>Seuraava kuva havainnollistaa mikropalveluarkkitehtuuriin perustuvan sovelluksen rakennetta perinteiseen monoliittiseen rakenteeseen verrattuna:</p>\n<picture><img src=\"/static/beecf1d05714ef6a4ac0721fce62d394/14be6/26.png\" srcset=\"/static/beecf1d05714ef6a4ac0721fce62d394/4cce7/26.png 200w,\n/static/beecf1d05714ef6a4ac0721fce62d394/bae5f/26.png 400w,\n/static/beecf1d05714ef6a4ac0721fce62d394/14be6/26.png 800w,\n/static/beecf1d05714ef6a4ac0721fce62d394/1b35a/26.png 1200w,\n/static/beecf1d05714ef6a4ac0721fce62d394/93539/26.png 1590w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Frontendin (kuvassa neliöitynä) rooli ei välttämättä poikkea malleissa kovinkaan paljoa, mikropalveluiden ja frontendin välissä on usein <a href=\"http://microservices.io/patterns/apigateway\">API gateway</a> joka tarjoaa frontendille perinteisen kaltaisen, \"yhdessä palvelimessa\" olevan näkymän backendiin, esim. <a href=\"https://medium.com/netflix-techblog/optimizing-the-netflix-api-5c9ac715cf19\">Netflix</a> käyttää tätä ratkaisua.</p>\n<p>Mikropalveluarkkitehtuurit ovat syntyneet ja kehittyneet suurten internetskaalan sovellusten tarpeisiin. Trendin aloitti Amazon jo kauan ennen termin microservice lanseeraamista. Tärkeä lähtölaukaus oli CEO Jeff Bezosin vuonna 2002 kaikille työntekijöille lähettämä email:</p>\n<blockquote>\n<p>All teams will henceforth expose their data and functionality through service interfaces.</p>\n<p>Teams must communicate with each other through these interfaces.</p>\n<p>There will be no other form of inter-process communication allowed: no direct linking, no direct reads of another team’s data store, no shared-memory model, no back-doors whatsoever. The only communication allowed is via service interface calls over the network.</p>\n<p>It doesn’t matter what technology you use.</p>\n<p>All service interfaces, without exception, must be designed from the ground up to be externalize-able. That is to say, the team must plan and design to be able to expose the interface to developers in the outside world.</p>\n<p>No exceptions.</p>\n<p>Anyone who doesn’t do this will be fired. Thank you; have a nice day!</p>\n</blockquote>\n<p>Nykyään eräs vahvimmista suunnannäyttäjistä mikropalveluiden suhteen on <a href=\"https://www.infoq.com/presentations/netflix-chaos-microservices\">Netflix</a>.</p>\n<p>Mikropalveluista on pikkuhiljaa tullut hype, tämän ajan <a href=\"https://en.wikipedia.org/wiki/No_Silver_Bullet\">silver bullet</a>, jota yritetään tarjota ratkaisuiksi lähes kaikkiin ongelmiin. Mikropalveluarkkitehtuurin soveltamiseen liittyy kuitenkin suuri määrä haasteita ja voi olla järkevämpi lähteä liikeelle <a href=\"https://martinfowler.com/bliki/MonolithFirst.html\">monolith first</a>, eli tehdä aluksi perinteinen kaiken sisältävä backend. Tai sitten <a href=\"https://martinfowler.com/articles/dont-start-monolith.html\">ei</a>. Mielipiteitä on monenlaisia. Molemmat linkit johtavat Martin Fowlerin sivuille, eli viisaimmat eivät ole ihan varmoja kumpi näistä oikeista tavoista on oikeampi.</p>\n<p>Emme voi valitettavasti syventyä tällä kurssilla tähän tärkeään aihepiiriin tämän tarkemmin. Jo pintapuolinenkin käsittely vaatisi ainakin 5 viikkoa lisää aikaa.</p>\n<h1>Serverless</h1>\n<p>Loppuvuodesta 2014 tapahtuneen Amazonin <a href=\"https://aws.amazon.com/lambda/\">lambda</a>-palvelun julkaisun jälkeen alkoi web-sovellusten kehittämiseen nousta jälleen uusi trendi, <a href=\"https://serverless.com/\">serverless</a>.</p>\n<p>Kyse on siitä, että lambda ja nyttemmin Googlen <a href=\"https://cloud.google.com/functions/\">Cloud functions</a> ja <a href=\"https://azure.microsoft.com/en-us/services/functions/\">Azuren vastaava toiminnallisuus</a> mahdollistavat <em>yksittäisten funktioiden suorittamisen</em> pilvessä, kun ennen tätä pienin pilvessä suoritettava yksikkö oli käytännössä yksittäinen <em>prosessi</em>, eli esim. Node-backendiä suorittava ajoympäristö.</p>\n<p>Esim. Amazonin <a href=\"https://aws.amazon.com/api-gateway/\">API-gateway</a>:n avulla on mahdollista tehdä \"palvelimettomia\" sovelluksia, missä määritellyn HTTP API:n kutsuihin vastataan suoraan pilvifunktioilla. Funktiot yleensä operoivat jo valmiiksi pilvipalvelun tietokantoihin talletetun datan avulla.</p>\n<p>Serverlessissä ei siis ole kyse siitä että sovelluksissa ei olisi palvelinta, vaan tavasta määritellä palvelin. Sovelluskehittäjät voivat siirtyä ohjelmoinnissa korkeammalle abstraktiotasolle, ei ole enää tarvetta määritellä ohjelmallisesti HTTP-kutsujen reitityksiä, tietokantayhteyksiä ym., pilvi-infrastruktuuri tarjoaa kaiken tämän. Pilvifunktioilla on myös mahdollista saada helposti aikaan hyvin skaalautuvia järjestelmiä, esim. Amazon Lambda pystyy suorittamaan massiivisen määrän pilvifunktioita sekunnissa. Kaikki tämä tapahtuu infrastruktuurin toimesta automaattisesti, ei ole tarvetta käynnistellä uusia palvelimia ym.</p>\n<h1>GraphQL</h1>\n<p>Tälläkin kurssilla moneen kertaan mainittu ja käytetty REST on ollut pitkään vallitseva tapa toteuttaa palvelimen selaimelle tarjoama rajapinta ja yleensäkin verkossa toimivien sovellusten välinen integraatio.</p>\n<p>RESTin rinnalle selaimessa (tai mobiililaitteessa) toimivan logiikan ja palvelimien väliseen kommunikointiin on viime vuosina noussut alunperin Facebookin kehittämä <a href=\"http://graphql.org/\">GraphQL</a>.</p>\n<p>GraphQL on filosofialtaan todella erilainen RESTiin verrattuna. REST on <em>resurssipohjainen</em>, jokaisella resurssilla, esim. <em>käyttäjällä</em> on oma sen identifioiva osoite, esim. <em>users/10</em>, ja kaikki resursseille tehtävät operaatiot toteutetaan tekemällä URL:ille kohdistuvia pyyntöjä, joiden toiminta määrittyy käytetyn HTTP-metodin avulla.</p>\n<p>RESTin resurssiperustaisuus toimii hyvin useissa tapauksissa, joissain tapauksissa se voi kuitenkin olla hieman kankea.</p>\n<p>Oletetaan että blogilistasovelluksemme sisältäisi somemaista toiminnallisuutta ja haluaisimme esim. näyttää sovelluksessa listan, joka sisältää kaikkien seuraamiemme (follow) käyttäjien blogeja kommentoineiden käyttäjien lisäämien blogien nimet.</p>\n<p>Jos palvelin toteuttaisi REST API:n, joutuisimme todennäköisesti tekemään monia HTTP-pyyntöjä selaimen koodista, ennen kuin saisimme muodostettua halutun datan. Pyyntöjen vastauksena tulisi myös paljon ylimääräistä dataa ja halutun datan keräävä selaimen koodi olisi todennäköisesti kohtuullisen monimutkainen.</p>\n<p>Jos kyseessä olisi usein käytetty toiminnallisuus, voitaisiin sitä varten toteuttaa oma REST-endpoint. Jos vastaavia skeaarioita olisi paljon, esim. kymmeniä, tulisi erittäin työlääksi toteuttaa kaikille toiminnallisuuksille oma REST-endpoint.</p>\n<p>GraphQL:n avulla toteutettava palvelin sopii tämänkaltaisiin tilanteisiin hyvin.</p>\n<p>GraphQL:ssä periaatteena, on että selaimen koodi muodostaa <em>kyselyn</em>, joka kuvailee haluttua dataa ja lähettää sen API:lle HTTP POST -pyynnöllä. Toisin kuin REST:issä, GraphQL:ssä kaikki kyselyt kohdistetaan samaan osoitteeseen ja ovat POST-tyyppisiä.</p>\n<p>Edellä kuvatun skenaarion data saataisiin haettua (suurinpiirtein) seuraavan kaltaisella kyselyllä:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">query FetchBlogsQuery <span class=\"token punctuation\">{</span>\n  user<span class=\"token punctuation\">(</span>username: <span class=\"token string\">'mluukkai'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    followedUsers <span class=\"token punctuation\">{</span>\n      blogs <span class=\"token punctuation\">{</span>\n        comments <span class=\"token punctuation\">{</span>\n          user <span class=\"token punctuation\">{</span>\n            blogs <span class=\"token punctuation\">{</span>\n              title\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Palvelimen vastaus pyyntöön olisi suunnilleen seuraavanlainen JSON-olio:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">{</span>\n  data: <span class=\"token punctuation\">{</span>\n    followedUsers: <span class=\"token punctuation\">{</span>\n      blogs: <span class=\"token punctuation\">{</span>\n        comments: <span class=\"token punctuation\">{</span>\n          user: <span class=\"token punctuation\">{</span>\n            blogs: <span class=\"token punctuation\">[</span>\n              <span class=\"token string\">'Goto considered harmful'</span>,\n              <span class=\"token string\">'End to End Testing with Puppeteer and Jest'</span>,\n              <span class=\"token string\">'Navigating your transition to GraphQL'</span>,\n              <span class=\"token string\">'From REST to GraphQL'</span>\n            <span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Sovelluslogiikka säilyy yksinkertaisena ja selaimen koodi saa täsmälleen haluamansa datan yksittäisellä kyselyllä.</p>\n<p>GraphQL:ää käytettäessä sovelluksen datasta on määriteltävä <a href=\"http://graphql.org/learn/schema/\">skeema</a>, joka kuvailee datan entiteettejä, eli esimerkkimme tapauksessa käyttäjiä, blogeja ja kommentteja sekä niiden suhteita, ks. lisää esim. blogista <a href=\"https://dev-blog.apollodata.com/navigating-your-transition-to-graphql-28a4dfa3acfb\">Navigating your transition to GraphQL</a>.</p>\n<p>GraphQL:n nimi tuleekin siitä, että entiteetit ja niiden suhteet muodostavat usein, etenkin sosiaalisen median tapaisissa sovelluksissa eräänlaisen verkon, missä entiteetit liittyvät toisiin entiteetteihin erilaisten <em>suhteiden</em> kautta.</p>\n<p>Nimestään huolimatta GraphQL:llä ei ole suoranaisesti mitään tekemistä tietokantojen kanssa, se ei ota mitään kantaa siihen miten data on tallennettu. GraphQL-periaattella toimivan API:n käyttämä data voi siis olla talletettu relaatiotietokantaan, dokumenttitietokantaan tai muille palvelimille, joita GraphQL-palvelin käyttää vaikkapa REST:in välityksellä. GraphQL on täysin ohjelmointikieliriippumaton, sekä GraphQL-clientien että -servereiden toteuttamisen tueksi on olemassa kirjastoja useilla ohjelmointikielillä.</p>\n<p>GraphQL on jo melko iäkäs teknologia, se on ollut Facebookin sisäisessä käytössä jo vuodesta 2012 lähtien, teknologian voi siis todeta olevan \"battle tested\". Facebook julkaisi GraphQL:n vuonna 2015 ja se on pikkuhiljaa saanut enenevissä määrin huomiota ja nousee ehkä lähivuosina uhmaamaan REST:in valta-asemaa.</p>\n<p>Teen kurssille ehkä tulevaisuudessa uuden, GraphQL:ää käsittelevän osan. Tänä keväänä se ei kuitenkaan tule ilmestymään. Jos haluat kulkea etujoukkojen mukana, voikin olla hyvä idea tutustua GraphQL:n <a href=\"https://courses.helsinki.fi/fi/TKT21010/121540755\">Full Stack -harjoitustyön</a> yhteydessä.</p>\n<p>Lisää GraphQL:stä esim. seuraavissa:</p>\n<ul>\n<li><a href=\"http://graphql.org/\">http://graphql.org/</a></li>\n<li><a href=\"https://github.com/facebook/graphql\">https://github.com/facebook/graphql</a></li>\n<li><a href=\"https://dev-blog.apollodata.com/full-stack-react-graphql-tutorial-582ac8d24e3b\">Tutoriaali</a> GraphQL:n käyttöön Reactista <a href=\"https://www.apollographql.com/docs/react/\">Apollo clientin</a> avulla</li>\n<li><a href=\"https://dev-blog.apollodata.com/why-graphql-is-the-future-3bec28193807\">Why GraphQL is the future</a></li>\n</ul>\n<h1>Cloud native app</h1>\n<p>Viime aikoina on myös yleistynyt termin pilvinatiivi, <em>cloud native</em> käyttö. Termillä ei ole mitään <a href=\"https://techcrunch.com/2016/08/03/what-real-cloud-native-apps-will-look-like/\">yhtenäistä määritelmää</a>.</p>\n<p><a href=\"https://pivotal.io/cloud-native\">Pivotal</a> määrittelee käsitteen seuraavasti</p>\n<blockquote>\n<p>Cloud-native is an approach to building and running applications that fully exploits the advantages of the cloud computing delivery model. Cloud-native is about how applications are created and deployed, not where. While today public cloud impacts the thinking about infrastructure investment for virtually every industry, a cloud-like delivery model isn’t exclusive to public environments. It's appropriate for both public and private clouds. Most important is the ability to offer nearly limitless computing power, on-demand, along with modern data and application services for developers. When companies build and operate applications in a cloud-native fashion, they bring new ideas to market faster and respond sooner to customer demands.</p>\n</blockquote>\n<p>Esim. Netflixin koko infrastruktuuria voi pitää pilvinatiivina. Netflixillä ei ole omia palvelimia, kaikki toimii Amazonin alustalla olevissa virtuaalikoneissa.</p>\n<p>Pilvinatiiviuteen liittyvät usein äsken mainitut mikropalvelut ja serverless-arkkitehtuuri. Tärkeä teema pilvinatiiveissa sovelluksissa on myös <a href=\"https://www.docker.com/what-container\">kontainereiden</a>, kuten Dockerin hyödyntäminen.</p>\n<h2>Hyödyllisiä kirjastoja ja mielenkiintoisia linkkejä</h2>\n<p>Facebookin ylläpitämä kirjasto <a href=\"https://github.com/facebook/immutable-js/\">immutable.js</a> tarjoaa muutamista tietorakenteista nimensä mukaisia <em>muuttumattomia</em> toteutuksia. Kirjastosta voi olla hyötyä Reduxia käytettäessä, sillä kuten osasta 5 <a href=\"/osa5/#puhtaat-funktiot-immutable\">muistamme</a> reducerien on oltava puhtaita funktioita eli ne eivät saa muuttaa storen tilaa vaan niiden on korvattava se muutostilanteissa uudella.</p>\n<p><a href=\"https://redux-saga.js.org/\">Redux-saga</a> tarjoaa osassa 6 käsitellylle <a href=\"/osa6/#asynkroniset-actionit-ja-redux-thunk\">redux thunkille</a> vaihtoehtoisen tavan tehdä asynkronisia actioneja. Jotkut hypettää ja tykkää, itse en.</p>\n<p>Single page -sovelluksissa analytiikkatietojen kerääminen käyttäjien sivuston kanssa käymästä vuorovaikutuksesta on <a href=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/single-page-applications\">haastavampaa</a> kuin perinteisissä, kokonaiseen sivun lataamiseen perustuvissa web-sovelluksissa. <a href=\"https://github.com/react-ga/react-ga\">React Google Analytics</a> -kirjasto tuo tähän avun.</p>\n<p>Voit hyödyntää React-osaamistasi myös mobiilisovellusten toteuttamiseen Facebookin erittäin suositun <a href=\"https://facebook.github.io/react-native/\">React Native</a> -kirjaston avulla.</p>\n<p>Javascript-projektien projektinhallintaan ja bundlaamiseen käytettyjen työkalujen rintamalla on ollut tuulista, best practicet ovat vaihdelleet nopeasti (vuosiluvut ovat suuntaa-antavia, kukaan ei enää muista noin kauas menneisyyteen):</p>\n<ul>\n<li>2011 <a href=\"https://www.npmjs.com/package/bower\">Bower</a></li>\n<li>2012 <a href=\"https://www.npmjs.com/package/grunt\">Grunt</a></li>\n<li>2013-14 <a href=\"https://www.npmjs.com/package/gulp\">Gulp</a></li>\n<li>2012-14 <a href=\"https://www.npmjs.com/package/browserify\">Browserify</a></li>\n<li>2015- <a href=\"https://www.npmjs.com/package/webpack\">Webpack</a></li>\n</ul>\n<p>Hipsterien suurin into työkalukehitykseen näytti pysähtyneen webpackin vallattua markkinat. Uusi tulokas <a href=\"https://parceljs.org\">Parcel</a> on kuitenkin saanut viime aikoina nopeasti paljon huomiota. Parcel markkinoi olevansa yksinkertainen, sitähän webpack ei missään nimessä ole, ja paljon nopeampi kuin webpack. Parcelin kehitystä kannattaa jäädä seuraamaan.</p>\n<p>Sivu <a href=\"https://reactpatterns.com/\">https://reactpatterns.com/</a> tarjoaa tiiviissä muodossa listan parhaita react-käytänteitä, joista osa on jo tältäkin kurssilta tuttuja. Toinen samankaltainen lista on <a href=\"https://vasanthk.gitbooks.io/react-bits/\">react bits</a>.</p>\n<p>Jos tiedät jotain suositeltavia linkkejä tai kirjastoja, tee pull request!</p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/part-7-e86c21108367fe9d9c833e8905547e9c.svg"},"part":7,"letter":"f"}}},"pageContext":{"part":7,"letter":"f"}}
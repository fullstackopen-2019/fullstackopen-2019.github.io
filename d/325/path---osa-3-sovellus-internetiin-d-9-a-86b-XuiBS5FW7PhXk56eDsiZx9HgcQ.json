{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<p>Palataan yritykseemme käyttää nyt tehtyä backendiä <a href=\"/osa2\">osassa 2</a> tehdyllä React-frontendillä. Aiempi yritys lopahti seuraavaan virheilmoitukseen</p>\n<picture><img src=\"/static/35a4438293bb22dd200358359d58157a/14be6/3.png\" srcset=\"/static/35a4438293bb22dd200358359d58157a/4cce7/3.png 200w,\n/static/35a4438293bb22dd200358359d58157a/bae5f/3.png 400w,\n/static/35a4438293bb22dd200358359d58157a/14be6/3.png 800w,\n/static/35a4438293bb22dd200358359d58157a/1b35a/3.png 1200w,\n/static/35a4438293bb22dd200358359d58157a/9ee03/3.png 1600w,\n/static/35a4438293bb22dd200358359d58157a/be508/3.png 1918w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Frontendin tekemä GET-pyyntö osoitteeseen <a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a> ei jostain syystä toimi. Mistä on kyse? Backend toimii kuitenkin selaimesta ja postmanista käytettäessä ilman ongelmaa.</p>\n<h3>Same origin policy ja CORS</h3>\n<p>Kyse on asiasta nimeltään CORS eli Cross-origin resource sharing. <a href=\"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing\">Wikipedian</a> sanoin</p>\n<blockquote>\n<p><i>Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the first resource was served. A web page may freely embed cross-origin images, stylesheets, scripts, iframes, and videos. Certain \"cross-domain\" requests, notably Ajax requests, are forbidden by default by the same-origin security policy.</i></p>\n</blockquote>\n<p>Lyhyesti sanottuna meidän kontekstissa kyse on seuraavasta: websovelluksen selaimessa suoritettava Javascript-koodi saa oletusarvoisesti kommunikoida vain samassa <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">originissa</a> olevan palvelimen kanssa. Koska palvelin on localhostin portissa 3001 ja frontend localhostin portissa 3000, niiden origin ei ole sama.</p>\n<p>Korostetaan vielä, että <a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">same origin policy</a> ja CORS eivät ole mitenkään React- tai Node-spesifisiä asioita, vaan yleismaailmallisia periaatteita Web-sovellusten toiminnasta.</p>\n<p>Voimme sallia muista <i>origineista</i> tulevat pyynnöt käyttämällä Noden <a href=\"https://github.com/expressjs/cors\">cors</a>-middlewarea.</p>\n<p>Asennetaan <i>cors</i> komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> cors --save</code></pre></div>\n<p>Otetaan middleware käyttöön ja sallitaan kaikki origineista tulevat pyynnöt:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> cors <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cors'</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Nyt frontend toimii! Tosin muistiinpanojen tärkeäksi muuttavaa toiminnallisuutta backendissa ei vielä ole.</p>\n<p>CORS:ista voi lukea tarkemmin esim. <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">Mozillan sivuilta</a>.</p>\n<h3>Sovellus internettiin</h3>\n<p>Kun koko \"stäkki\" on saatu vihdoin kuntoon, siirretään sovellus internettiin. Käytetään seuraavassa vanhaa kunnon <a href=\"https://www.heroku.com\">Herokua</a>.</p>\n<blockquote>\n<p><i>Jos et ole koskaan käyttänyt herokua, löydät käyttöohjeita kurssin <a href=\"https://materiaalit.github.io/tsoha-18/viikko1/\">Tietokantasovellus</a>-materiaalista ja Googlaamalla...</i></p>\n</blockquote>\n<p>Lisätään projektin juureen tiedosto <i>Procfile</i>, joka kertoo Herokulle, miten sovellus käynnistetään</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">web: node index.js</code></pre></div>\n<p>Muutetaan tiedoston <i>index.js</i> lopussa olevaa sovelluksen käyttämän portin määrittelyä seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3001</span></span>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`Server running on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Nyt käyttöön tulee <a href=\"https://en.wikipedia.org/wiki/Environment_variable\">ympäristömuuttujassa</a> <em>PORT</em> määritelty portti tai 3001 jos ympäristömuuttuja <em>PORT</em> ei ole määritelty. Heroku konfiguroi sovelluksen portin ympäristömuuttujan avulla.</p>\n<p>Tehdään projektihakemistosta git-repositorio, lisätään <i>.gitignore</i> jolla seuraava sisältö</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">node_modules</code></pre></div>\n<p>Luodaan heroku-sovellus komennolla <i>heroku create</i>, tehdään sovelluksen hakemistosta git-repositorio, commitoidaan koodi ja siirretään se Herokuun komennolla <i>git push heroku master</i>.</p>\n<p>Jos kaikki meni hyvin, sovellus toimii:</p>\n<picture><img src=\"/static/5aeaef442a848d11a2e2ad41518496b1/14be6/25a.png\" srcset=\"/static/5aeaef442a848d11a2e2ad41518496b1/4cce7/25a.png 200w,\n/static/5aeaef442a848d11a2e2ad41518496b1/bae5f/25a.png 400w,\n/static/5aeaef442a848d11a2e2ad41518496b1/14be6/25a.png 800w,\n/static/5aeaef442a848d11a2e2ad41518496b1/1b35a/25a.png 1200w,\n/static/5aeaef442a848d11a2e2ad41518496b1/9ee03/25a.png 1600w,\n/static/5aeaef442a848d11a2e2ad41518496b1/8057d/25a.png 1656w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Jos ei, vikaa voi selvittää herokun lokeja lukemalla, eli komennolla <i>heroku logs</i>.</p>\n<blockquote>\n<p><strong>HUOM</strong> ainakin alussa on järkevää tarkkailla Herokussa olevan sovelluksen lokeja koko ajan. Parhaiten tämä onnistuu antamalla komento <i>heroku logs -t</i>, jolloin logit tulevat konsoliin sitä mukaan kun palvelimella tapahtuu jotain.</p>\n</blockquote>\n<p>Myös frontend toimii Herokussa olevan backendin avulla. Voit varmistaa asian muuttamalla frontendiin määritellyn backendin osoitteen viittaamaan <i><a href=\"http://localhost:3001\">http://localhost:3001</a></i>:n sijaan Herokussa olevaan backendiin.</p>\n<p>Seuraavaksi herää kysymys miten saamme myös frontendin internettiin? Vaihtoehtoja on useita, mutta käydään seuraavaksi läpi yksi niistä.</p>\n<h3>Frontendin tuotantoversio</h3>\n<p>Olemme toistaiseksi suorittaneet React-koodia <i>sovelluskehitysmoodissa</i>, missä sovellus on konfiguroitu antamaan havainnollisia virheilmoituksia, päivittämään koodiin tehdyt muutokset automaattisesti selaimeen ym.</p>\n<p>Kun sovellus viedään tuotantoon, täytyy siitä tehdä <a href=\"https://reactjs.org/docs/optimizing-performance.html#use-the-production-build\">production build</a>\neli tuotantoa varten optimoitu versio.</p>\n<p><i>create-react-app</i>:in avulla tehdyistä sovelluksista saadaan muodostettua tuotantoversio komennolla <a href=\"https://github.com/facebookincubator/create-react-app#npm-run-build-or-yarn-build\">npm run build</a>.</p>\n<p>Suoritetaan nyt komento <i>frontendin projektin juuressa</i>.</p>\n<p>Komennon seurauksena syntyy hakemiston <i>build</i> (joka sisältää jo sovelluksen ainoan html-tiedoston <i>index.html</i>) sisään hakemisto <i>static</i>, minkä alle generoituu sovelluksen Javascript-koodin <a href=\"https://en.wikipedia.org/wiki/Minification_(programming)\">minifioitu</a> versio. Vaikka sovelluksen koodi on kirjoitettu useaan tiedostoon, generoituu kaikki Javascript yhteen tiedostoon, samaan tiedostoon tulee itseasiassa myös kaikkien sovelluksen koodin tarvitsemien riippuvuuksien koodi.</p>\n<p>Minifioitu koodi ei ole miellyttävää luettavaa. Koodin alku näyttää seuraavalta:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">!</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">function</span> <span class=\"token function\">r</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> n<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">,</span>i<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>l<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>a<span class=\"token operator\">=</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>c<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>s<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>c<span class=\"token operator\">&lt;</span>i<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>c<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>f<span class=\"token operator\">=</span>i<span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>n <span class=\"token keyword\">in</span> l<span class=\"token punctuation\">)</span>Object<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>hasOwnProperty<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>l<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">p</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> u<span class=\"token punctuation\">.</span>push<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">,</span>a<span class=\"token operator\">||</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">function</span> <span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> e<span class=\"token punctuation\">,</span>r<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>r<span class=\"token operator\">&lt;</span>u<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>r<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>u<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>n<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>t<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span> l<span class=\"token operator\">=</span>t<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token number\">0</span><span class=\"token operator\">!==</span>o<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>n<span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">--</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>e<span class=\"token operator\">=</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>s<span class=\"token operator\">=</span>t<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token keyword\">return</span> e<span class=\"token punctuation\">}</span><span class=\"token keyword\">var</span> n<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>o<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>u<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">return</span> n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">;</span><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span>n<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">:</span>r<span class=\"token punctuation\">,</span>l<span class=\"token punctuation\">:</span><span class=\"token operator\">!</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>exports<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span> e<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>l<span class=\"token operator\">=</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">}</span>f<span class=\"token punctuation\">.</span>m<span class=\"token operator\">=</span>e<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span>c<span class=\"token operator\">=</span>n<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">d</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>f<span class=\"token punctuation\">.</span><span class=\"token function\">o</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">)</span><span class=\"token operator\">||</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>enumerable<span class=\"token punctuation\">:</span><span class=\"token operator\">!</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">:</span>t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">r</span><span class=\"token operator\">=</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"undefined\"</span><span class=\"token operator\">!==</span><span class=\"token keyword\">typeof</span> Symbol<span class=\"token operator\">&amp;&amp;</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token operator\">&amp;&amp;</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span>Symbol<span class=\"token punctuation\">.</span>toStringTag<span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span><span class=\"token string\">\"Module\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Staattisten tiedostojen tarjoaminen backendistä</h3>\n<p>Eräs mahdollisuus frontendin tuotantoon viemiseen on kopioida tuotantokoodi, eli hakemisto <i>build</i> backendin repositorion juureen ja määritellä backend näyttämään pääsivunaan frontendin <i>pääsivu</i>, eli tiedosto <i>build/index.html</i>.</p>\n<p>Aloitetaan kopioimalla frontendin tuotantokoodi backendin alle, projektin juureen. Omalla koneellani kopiointi tapahtuu frontendin hakemistosta käsin komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> -r build <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/osa3/notes-backend</code></pre></div>\n<p>Backendin sisältävän hakemiston tulee nyt näyttää seuraavalta:</p>\n<picture><img src=\"/static/a7724db60dee0c2ef626ba27021be323/14be6/27.png\" srcset=\"/static/a7724db60dee0c2ef626ba27021be323/4cce7/27.png 200w,\n/static/a7724db60dee0c2ef626ba27021be323/bae5f/27.png 400w,\n/static/a7724db60dee0c2ef626ba27021be323/14be6/27.png 800w,\n/static/a7724db60dee0c2ef626ba27021be323/1b35a/27.png 1200w,\n/static/a7724db60dee0c2ef626ba27021be323/cbaf6/27.png 1404w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Jotta saamme expressin näyttämään <i>staattista sisältöä</i> eli sivun <i>index.html</i> ja sen lataaman Javascriptin ym. tarvitsemme expressiin sisäänrakennettua middlewarea <a href=\"http://expressjs.com/en/starter/static-files.html\">static</a>.</p>\n<p>Kun lisäämme muiden middlewarejen määrittelyn yhteyteen seuraavan</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token keyword\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>tarkastaa Express GET-tyyppisten HTTP-pyyntöjen yhteydessä ensin löytyykö pyynnön polkua vastaavan nimistä tiedostoa hakemistosta <i>build</i>. Jos löytyy, palauttaa express tiedoston.</p>\n<p>Nyt HTTP GET -pyyntö osoitteeseen <i>www.palvelimenosoite.com/index.html</i> tai <i>www.palvelimenosoite.com</i> näyttää Reactilla tehdyn frontendin. GET-pyynnön esim. osoitteeseen <i>www.palvelimenosoite.com/notes</i> hoitaa backendin koodi.</p>\n<p>Koska tässä tapauksessa sekä frontend että backend toimivat samassa osoitteessa, voidaan React-sovelluksessa tapahtuva backendin <em>baseUrl</em> määritellä <a href=\"https://www.w3.org/TR/WD-html40-970917/htmlweb.html#h-5.1.2\">suhteellisena</a> URL:ina, eli ilman palvelinta yksilöivää osaa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/notes'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>baseUrl<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Muutoksen jälkeen on luotava uusi production build ja kopioitava se backendin repositorion juureen.</p>\n<p>Sovellusta voidaan käyttää nyt <i>backendin</i> osoitteesta <a href=\"http://localhost:3001\">http://localhost:3001</a>:</p>\n<picture><img src=\"/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/14be6/28.png\" srcset=\"/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/4cce7/28.png 200w,\n/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/bae5f/28.png 400w,\n/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/14be6/28.png 800w,\n/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/1b35a/28.png 1200w,\n/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/9ee03/28.png 1600w,\n/static/7813e73a2e6a9ba8a1c7a690b9ed4bb2/443cd/28.png 1634w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Sovelluksemme toiminta vastaa nyt täysin osan 0 luvussa <a href=\"/osa0/#single-page-app\">Single page app</a> läpikäydyn esimerkkisovelluksen toimintaa.</p>\n<p>Kun mennään selaimella osoitteeseen <a href=\"http://localhost:3001\">http://localhost:3001</a> palauttaa palvelin hakemistossa <i>build</i> olevan tiedoston <i>index.html</i>, jonka sisältö hieman tiivistettynä on seuraava:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/css/main.f9a47af2.chunk.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/1.578f4ea1.chunk.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/main.104ca08d.chunk.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Sivu sisältää ohjeen ladata sovelluksen tyylit määrittelevän CSS-tiedoston, sekä kaksi <i>script</i>-tagia, joiden ansiosta selain lataa sovelluksen Javascript-koodin, eli varsinaisen React-sovelluksen.</p>\n<p>React-koodi hakee palvelimelta muistiinpanot osoitteesta <a href=\"http://localhost:3001/notes\">http://localhost:3001/notes</a> ja renderöi ne ruudulle. Selaimen ja palvelimen kommunikaatio selviää tuttuun tapaan konsolin välilehdeltä <i>Network</i>:</p>\n<picture><img src=\"/static/1e1368a997893e8974695a5c76897b83/14be6/29.png\" srcset=\"/static/1e1368a997893e8974695a5c76897b83/4cce7/29.png 200w,\n/static/1e1368a997893e8974695a5c76897b83/bae5f/29.png 400w,\n/static/1e1368a997893e8974695a5c76897b83/14be6/29.png 800w,\n/static/1e1368a997893e8974695a5c76897b83/1b35a/29.png 1200w,\n/static/1e1368a997893e8974695a5c76897b83/9ee03/29.png 1600w,\n/static/1e1368a997893e8974695a5c76897b83/5e830/29.png 1688w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Kun sovelluksen \"internettiin vietävä\" versio todetaan toimivan paikallisesti, commitoidaan frontendin tuotantoversio backendin repositorioon ja pushataan koodi uudelleen herokuun.</p>\n<p><a href=\"https://gentle-ravine-74840.herokuapp.com/\">Sovellus</a> toimii moitteettomasti lukuunottamatta vielä backendiin toteuttamatonta muistiinpanon tärkeyden muuttamista:</p>\n<picture><img src=\"/static/936724db593511bf5a38f2653d92f346/14be6/30.png\" srcset=\"/static/936724db593511bf5a38f2653d92f346/4cce7/30.png 200w,\n/static/936724db593511bf5a38f2653d92f346/bae5f/30.png 400w,\n/static/936724db593511bf5a38f2653d92f346/14be6/30.png 800w,\n/static/936724db593511bf5a38f2653d92f346/1b35a/30.png 1200w,\n/static/936724db593511bf5a38f2653d92f346/9ee03/30.png 1600w,\n/static/936724db593511bf5a38f2653d92f346/383d0/30.png 1652w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Sovelluksemme tallettama tieto ei ole ikuisesti pysyvää, sillä sovellus tallettaa muistiinpanot muuttujaan. Jos sovellus kaatuu tai se uudelleenkäynnistetään, kaikki tiedot katoavat.</p>\n<p>Tarvitsemme sovelluksellemme tietokannan. Ennen tietokannan käyttöönottoa katsotaan kuitenkin vielä muutamaa asiaa.</p>\n<h3>Frontendin deployauksen suoraviivaistus</h3>\n<p>Jotta uuden frontendin version generointi onnistuisi jatkossa ilman turhia manuaalisia askelia, tehdään frontendin repositorion juureen yksinkertainen shell-scripti, joka suorittaa uuden tuotantoversion buildaamisen eli komennon <em>npm run build</em> ja sen siirron backendin alle. Annetaan skriptille nimeksi <i>deploy.sh</i>. Sisältö on seuraava</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token function\">npm</span> run build\n<span class=\"token function\">rm</span> -rf <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/osa3/notebackend/build\n<span class=\"token function\">cp</span> -r build <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/osa3/notebackend/</code></pre></div>\n<p>Skriptille pitää antaa vielä suoritusoikeudet:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> u+x deploy.sh</code></pre></div>\n<p>Skripti voidaan suorittaa frontendin juuresta komennolla <em>./deploy.sh</em></p>\n<h3>Backendin urlit</h3>\n<p>Backendin tarjoama muistiinpanojen käsittelyn rajapinta on nyt suoraan sovelluksen URL:in <a href=\"https://gentle-ravine-74840.herokuapp.com/\">https://gentle-ravine-74840.herokuapp.com/</a> alla. Eli <a href=\"https://gentle-ravine-74840.herokuapp.com//notes\">https://gentle-ravine-74840.herokuapp.com//notes</a> on kaikkien mustiinpanojen lista ym. Koska backendin roolina on tarjota frontendille koneluettava rajapinta, eli API, olisi ehkä parempi erottaa API:n tarjoama osoitteisto selkeämmin, esim. aloittamalla kaikki sanalla <em>api</em>.</p>\n<p>Tehdään muutos ensin muuttamalla käsin <strong>kaikki backendin routet</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//...</span>\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/notes'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>notes<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//...</span></code></pre></div>\n<p>Frontendin koodiin riittää seuraava muutos</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/notes'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>baseUrl<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Muutosten jälkeen esim. kaikki muistiinpanot tarjoavan API-endpointin osoite on <a href=\"https://gentle-ravine-74840.herokuapp.com/api/notes\">https://gentle-ravine-74840.herokuapp.com/api/notes</a></p>\n<picture><img src=\"/static/9f4b41816732a42aea85f932671352b2/14be6/31.png\" srcset=\"/static/9f4b41816732a42aea85f932671352b2/4cce7/31.png 200w,\n/static/9f4b41816732a42aea85f932671352b2/bae5f/31.png 400w,\n/static/9f4b41816732a42aea85f932671352b2/14be6/31.png 800w,\n/static/9f4b41816732a42aea85f932671352b2/1b35a/31.png 1200w,\n/static/9f4b41816732a42aea85f932671352b2/9ee03/31.png 1600w,\n/static/9f4b41816732a42aea85f932671352b2/8d593/31.png 1662w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Frontend on edelleen sovelluksen juuressa eli osoitteessa <a href=\"https://fullstack-notes.herokuapp.com/\">https://fullstack-notes.herokuapp.com/</a>.</p>\n<blockquote>\n<p>Sivuhuomautus: <strong>API:en versiointi</strong></p>\n<p>Joskus API:n urleissa ilmaistaan myös API:n versio. Eri versioita saatetaan tarvita, jos aikojen kuluessa API:in tehdään laajennuksia, jotka ilman versiointia hajoittaisivat olemassaolevia osia ohjelmista. Versioinnin avulla voidaan tuoda vanhojen rinnalle uusia, hieman eri tavalla toimivia versioita API:sta.</p>\n<p>API:n version ilmaiseminen URL:issa ei kuitenkaan ole välttämättä, ainakaan kaikkien mielestä järkevää vaikka tapaa paljon käytetäänkin. Oikeasta tavasta API:n versiointiin <a href=\"https://stackoverflow.com/questions/389169/best-practices-for-api-versioning\">kiistellään ympäri internettiä</a>.</p>\n</blockquote>\n<h3>Proxy</h3>\n<p>Frontendiin tehtyjen muutosten seurauksena on nyt se, että kun suoritamme frontendiä sovelluskehitysmoodissa, eli käynnistämällä sen komennolla <em>npm start</em>, yhteys backendiin ei toimi:</p>\n<picture><img src=\"/static/908e4125dac1e4317c489e8f5547dc5d/14be6/32.png\" srcset=\"/static/908e4125dac1e4317c489e8f5547dc5d/4cce7/32.png 200w,\n/static/908e4125dac1e4317c489e8f5547dc5d/bae5f/32.png 400w,\n/static/908e4125dac1e4317c489e8f5547dc5d/14be6/32.png 800w,\n/static/908e4125dac1e4317c489e8f5547dc5d/1b35a/32.png 1200w,\n/static/908e4125dac1e4317c489e8f5547dc5d/9ee03/32.png 1600w,\n/static/908e4125dac1e4317c489e8f5547dc5d/71908/32.png 1642w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Syynä tälle on se, että backendin osoite muutettiin suhteellisesti määritellyksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> baseUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/notes'</span></code></pre></div>\n<p>Koska frontend toimii osoitteessa <i>localhost:3000</i>, menevät backendiin tehtävät pyynnöt väärään osoitteeseen <i>localhost:3000/api/notes</i>. Backend toimii kuitenkin osoitteessa <i>localhost:3001</i></p>\n<p>create-react-app:illa luoduissa projekteissa ongelma on helppo ratkaista. Riittää, että frontendin repositorion tiedostoon <i>package.json</i> lisätään seuraava määritelmä:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"dependencies\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n    // <span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"scripts\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n    // <span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">}</span>,\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"proxy\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"http://localhost:3001\"</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Uudelleenkäynnistyksen jälkeen Reactin sovelluskehitysympäristö toimii <a href=\"https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#proxying-api-requests-in-development\">proxynä</a> ja jos React-koodi tekee HTTP-pyynnön palvelimen <i><a href=\"http://localhost:3000\">http://localhost:3000</a></i> johonkin osoitteeseen joka ei ole React-sovelluksen vastuulla (eli kyse ei ole esim. sovelluksen Javascript-koodin tai CSS:n lataamisesta), lähetetään pyyntö edelleen osoitteessa <i><a href=\"http://localhost:3001\">http://localhost:3001</a></i> olevalle palvelimelle.</p>\n<p>Nyt myös frontend on kunnossa, se toimii sekä sovelluskehitysmoodissa että tuotannossa yhdessä palvelimen kanssa.</p>\n<p>Eräs negatiivinen puoli käyttämässämme lähestymistavassa on se, että sovelluksen uuden version tuotantoon vieminen edellyttää frontendin koodin tuotantoversion generoinnista ja sen backendin repositorion kopioimisesta huolehtivan skriptin <i>delpoy.sh</i> suorittamisen. Tämä taas hankaloittaa automatisoidun <a href=\"https://martinfowler.com/bliki/DeploymentPipeline.html\">deployment pipelinen</a> toteuttamista. Deployment pipelinellä tarkoitetaan automatisoitua ja hallittua tapaa viedä koodi sovelluskehittäjän koneelta erilaisten testien ja laadunhallinnallisten vaiheiden kautta tuotantoympäristöön.</p>\n<p>Tähänkin on useita erilaisia ratkaisuja (esim. sekä frontendin että backendin <a href=\"https://github.com/mars/heroku-cra-node\">sijoittaminen samaan repositorioon</a>), emme kuitenkaan nyt mene niihin.</p>\n<p>Myös frontendin koodin deployaaminen omana sovelluksenaan voi joissain tilanteissa olla järkevää. create-react-app:in avulla luotujen sovellusten osalta se on <a href=\"https://github.com/mars/create-react-app-buildpack\">suoraviivaista</a>.</p>\n<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href=\"https://github.com/fullstack-hy2019/part3-notes-backend/tree/part3-3\">githubissa</a>, branchissa <i>part3-3</i>.</p>\n</div>\n<div class=\"tasks\">\n<h3>Tehtäviä</h3>\n<p>Seuraavissa tehtävissä koodia ei tarvita montaa riviä. Tehtävät ovat kuitenkin haastavia, sillä nyt on tarkaleen hallittava missä tapahtuu mitäkin, ja kaikki konfiguraatiot on tehtävä täsmälleen oikein. </p>\n<h4>3.9 puhelinluettelon backend step9</h4>\n<p>Laita backend toimimaan edellisessä osassa tehdyn puhelinluettelon frontendin kanssa muilta osin, paitsi mahdollisen puhelinnumeron muutoksen osalta, jonka vastaava toiminnallisuus toteutetaan backendiin vasta tehtävässä 3.17.</p>\n<p>Joudut todennäköisesti tekemään frontendiin erinäisiä pieniä muutoksia ainakin backendin oletettujen urlien osalta. Muista pitää selaimen konsoli koko ajan auki. Jos jotkut HTTP-pyynnöt epäonnistuvat, kannattaa katsoa <i>Network</i>-välilehdeltä mitä tapahtuu. Pidä myös silmällä mitä palvelimen konsolissa tapahtuu. Jos et tehnyt edellistä tehtävää, kannattaa POST-pyyntöä käsittelevässä tapahtumankäsittelijässä tulostaa konsoliin mukana tuleva data eli <i>request.body</i>.</p>\n<h4>3.10 puhelinluettelon backend step10</h4>\n<p>Vie sovelluksen backend internetiin, esim. Herokuun. </p>\n<p><strong>Huom</strong> komento <em>heroku</em> toimii laitoksen koneilla ja fuksikannettavilla. Jos et jostain syystä saa <a href=\"https://devcenter.heroku.com/articles/heroku-cli\">asennettua</a> herokua koneellesi, voit käyttää komentoa <a href=\"https://www.npmjs.com/package/heroku-cli\">npx heroku-cli</a>.</p>\n<p>Testaa selaimen ja postmanin tai VS Code REST clientin avulla, että internetissä oleva backend toimii.</p>\n<p><strong>PRO TIP:</strong> kun deployaat sovelluksen herokuun, kannattaa ainakin alkuvaiheissa pitää <strong>KOKO AJAN</strong> näkyvillä Herokussa olevan sovelluksen loki antamalla komento <em>heroku logs -t</em>. </p>\n<p>Seuraavassa loki eräästä tyypillisestä ongelmatilanteesta, heroku ei löydä sovelluksen riippuvuutena olevaa moduulia <i>express</i>:</p>\n<picture><img src=\"/static/9c32d4d565c7179d84334ba086ed03b9/14be6/33.png\" srcset=\"/static/9c32d4d565c7179d84334ba086ed03b9/4cce7/33.png 200w,\n/static/9c32d4d565c7179d84334ba086ed03b9/bae5f/33.png 400w,\n/static/9c32d4d565c7179d84334ba086ed03b9/14be6/33.png 800w,\n/static/9c32d4d565c7179d84334ba086ed03b9/1b35a/33.png 1200w,\n/static/9c32d4d565c7179d84334ba086ed03b9/9ee03/33.png 1600w,\n/static/9c32d4d565c7179d84334ba086ed03b9/beddc/33.png 1610w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Syynä ongelmalle on se, että <i>expressiä</i> asennettaessa oli unohtunut antaa optio <i>--save</i>, joka tallentaa tiedon riippuvuudesta tiedostoon <i>package.json</i>. </p>\n<p>Toinen tyypillinen ongelma on se, että sovellusta ei ole konfiguroitu käyttämään ympäristömuuttujana <em>PORT</em> määriteltyä porttia:</p>\n<picture><img src=\"/static/ca43fb98bc62fbd1d6a918b4d965274e/14be6/34.png\" srcset=\"/static/ca43fb98bc62fbd1d6a918b4d965274e/4cce7/34.png 200w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/bae5f/34.png 400w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/14be6/34.png 800w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/1b35a/34.png 1200w,\n/static/ca43fb98bc62fbd1d6a918b4d965274e/136ae/34.png 1598w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tee repositorion juureen tiedosto README.md ja lisää siihen linkki internetissä olevaan sovellukseesi.</p>\n<h4>3.11 puhelinluettelo full stack</h4>\n<p>Generoi frontendistä tuotantoversio ja lisää se internetissä olevaan sovellukseesi tässä osassa esiteltyä menetelmää noudattaen.</p>\n<p><strong>Huom</strong> eihän hakemisto <i>build</i> ole gitignoroituna projektissasi?</p>\n<p>Huolehdi myös, että frontend toimii edelleen myös paikallisesti.</p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/part-3-6502baf3ac1171cebf38f6bc8b3a36dc.svg"},"part":3,"letter":"b"}}},"pageContext":{"part":3,"letter":"b"}}